<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OMiSCID(aka O3MiSCID): Omiscid::TcpServer Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li id="current"><a href="classes.html"><span>Classes</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="classes.html"><span>Alphabetical&nbsp;List</span></a></li>
    <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
    <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
    <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="namespace_omiscid.html">Omiscid</a>::<a class="el" href="class_omiscid_1_1_tcp_server.html">TcpServer</a></div>
<h1>Omiscid::TcpServer Class Reference</h1><!-- doxytag: class="Omiscid::TcpServer" --><!-- doxytag: inherits="Omiscid::MsgSocket,Omiscid::ComTools" -->TCP Server.
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="_tcp_server_8h-source.html">Com/TcpServer.h</a>&gt;</code>
<p>
<p>Inheritance diagram for Omiscid::TcpServer:
<p><center><img src="class_omiscid_1_1_tcp_server.png" usemap="#Omiscid::TcpServer_map" border="0" alt=""></center>
<map name="Omiscid::TcpServer_map">
<area href="class_omiscid_1_1_msg_socket.html" alt="Omiscid::MsgSocket" shape="rect" coords="0,56,163,80">
<area href="class_omiscid_1_1_com_tools.html" alt="Omiscid::ComTools" shape="rect" coords="173,56,336,80">
<area href="class_omiscid_1_1_thread.html" alt="Omiscid::Thread" shape="rect" coords="0,0,163,24">
<area href="class_omiscid_1_1_connector.html" alt="Omiscid::Connector" shape="rect" coords="0,168,163,192">
<area href="class_omiscid_1_1_control_server.html" alt="Omiscid::ControlServer" shape="rect" coords="173,168,336,192">
<area href="class_omiscid_1_1_service.html" alt="Omiscid::Service" shape="rect" coords="86,224,249,248">
<area href="class_omiscid_1_1_service_from_x_m_l.html" alt="Omiscid::ServiceFromXML" shape="rect" coords="259,224,422,248">
</map>
<a href="class_omiscid_1_1_tcp_server-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#bc977059ef61f1c42f5fda1bc5945ab0">TcpServer</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Constructor.  <a href="#bc977059ef61f1c42f5fda1bc5945ab0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#2051315b5ad937b3f1a67f17a6f130e7">TcpServer</a> (int port, int pid=0)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Constructor.  <a href="#2051315b5ad937b3f1a67f17a6f130e7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#728a9e31c53cf86887f1f6149b1c46dd">~TcpServer</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destructor.  <a href="#728a9e31c53cf86887f1f6149b1c46dd"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#319287ed5b4e36cfdc8cf77dc0c0f822">Create</a> (int port=0)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Lauch the TCP Server.  <a href="#319287ed5b4e36cfdc8cf77dc0c0f822"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="0fab90d0581d4bf34ed8bc433bccb040"></a><!-- doxytag: member="Omiscid::TcpServer::Disconnect" ref="0fab90d0581d4bf34ed8bc433bccb040" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#0fab90d0581d4bf34ed8bc433bccb040">Disconnect</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destroy all the connections. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="d987b90e8824c0bf8eb9968f88818683"></a><!-- doxytag: member="Omiscid::TcpServer::DisconnectPeerId" ref="d987b90e8824c0bf8eb9968f88818683" args="(unsigned int PeerId)" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#d987b90e8824c0bf8eb9968f88818683">DisconnectPeerId</a> (unsigned int PeerId)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destroy a specific connection. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="0b357d7c75aa9892953bbd20b2687f9d"></a><!-- doxytag: member="Omiscid::TcpServer::Close" ref="0b357d7c75aa9892953bbd20b2687f9d" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#0b357d7c75aa9892953bbd20b2687f9d">Close</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Close the Server <a class="el" href="class_omiscid_1_1_socket.html">Socket</a>. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#55541631515a196a876d1e31b5d3e957">SendToClient</a> (int len, const char *buf, unsigned int pid)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send data to a client.  <a href="#55541631515a196a876d1e31b5d3e957"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#c8626847c8c147546061b209d1f1a6c7">SendToAllClients</a> (int len, const char *buf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#4ec1f48fa936759a99f28ecd5a0e1b29">SendToClient</a> (int *tab_len, const char **tab_buf, int nb_buf, unsigned int pid)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send a cutted message to one client.  <a href="#4ec1f48fa936759a99f28ecd5a0e1b29"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#3921f222948da678ab255407f9a5a582">SendToAllClients</a> (int *tab_len, const char **tab_buf, int nb_buf)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send a cutted message to all the clients.  <a href="#3921f222948da678ab255407f9a5a582"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#826ff4bb9524d87d88893cd3740f1c83">GetNbConnections</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Current number of connections.  <a href="#826ff4bb9524d87d88893cd3740f1c83"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#bcdbecbc9f2dc8451856557925e72d4c">AcceptConnection</a> (<a class="el" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a> *msgsocket)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Accept a new TCP Connection.  <a href="#bcdbecbc9f2dc8451856557925e72d4c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="d1c7a4f33733a8a33c7580d2f96ac1d4"></a><!-- doxytag: member="Omiscid::TcpServer::AddCallbackObject" ref="d1c7a4f33733a8a33c7580d2f96ac1d4" args="(MsgSocketCallbackObject *CallbackObject)" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#d1c7a4f33733a8a33c7580d2f96ac1d4">AddCallbackObject</a> (<a class="el" href="class_omiscid_1_1_msg_socket_callback_object.html">MsgSocketCallbackObject</a> *CallbackObject)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a callback object for notification. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="4e34be9756270406e5cad5ef1e6c988f"></a><!-- doxytag: member="Omiscid::TcpServer::RemoveCallbackObject" ref="4e34be9756270406e5cad5ef1e6c988f" args="(MsgSocketCallbackObject *CallbackObject)" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#4e34be9756270406e5cad5ef1e6c988f">RemoveCallbackObject</a> (<a class="el" href="class_omiscid_1_1_msg_socket_callback_object.html">MsgSocketCallbackObject</a> *CallbackObject)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove a callback object for notification. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="d0ce5f1ffbebe111122adcde750d0c0b"></a><!-- doxytag: member="Omiscid::TcpServer::RemoveAllCallbackObjects" ref="d0ce5f1ffbebe111122adcde750d0c0b" args="()" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#d0ce5f1ffbebe111122adcde750d0c0b">RemoveAllCallbackObjects</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove all callback objects for notification. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#6843802ccb0192190d48ebb5b3a2efb8">SetServiceId</a> (unsigned int pid)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Define the service Id used in the header of each sent messages.  <a href="#6843802ccb0192190d48ebb5b3a2efb8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#aa8162daf6602a0611e631a5496a9c05">GetServiceId</a> () const</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Access to the service id.  <a href="#aa8162daf6602a0611e631a5496a9c05"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#9a6dfaf0c6a8e7348c8c7d96da133d56">GetListPeerId</a> (<a class="el" href="class_omiscid_1_1_simple_list.html">SimpleList</a>&lt; unsigned int &gt; &amp;list_peer)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned short&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#c6a92b461be318d0509e0936c51ade6d">GetTcpPort</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Access to the port number.  <a href="#c6a92b461be318d0509e0936c51ade6d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="31f2343ebf5fc3fa67879cf77af88852"></a><!-- doxytag: member="Omiscid::TcpServer::GetMaxMessageSizeForTCP" ref="31f2343ebf5fc3fa67879cf77af88852" args="()" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#31f2343ebf5fc3fa67879cf77af88852">GetMaxMessageSizeForTCP</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="7c4785fddd7dcd630a6daf1d0e1b09aa"></a><!-- doxytag: member="Omiscid::TcpServer::SetMaxMessageSizeForTCP" ref="7c4785fddd7dcd630a6daf1d0e1b09aa" args="(int max)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#7c4785fddd7dcd630a6daf1d0e1b09aa">SetMaxMessageSizeForTCP</a> (int max)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">size max for message on TCP Define the size max accepted for exchange on TCP (by default the value is 1&lt;&lt;16) <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual <a class="el" href="class_omiscid_1_1_com_tools.html">ComTools</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#67ee8db36b2ad5308a70c3c7119fef02">Cast</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Cast in <a class="el" href="class_omiscid_1_1_com_tools.html">ComTools</a>.  <a href="#67ee8db36b2ad5308a70c3c7119fef02"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#9db05c42a092a2a224f8130ec925249f">IsStillConnected</a> (unsigned int peer_id)</td></tr>

<tr><td colspan="2"><br><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#caa93ccbbf148971015c04f8b1d4e2b5">FindClientFromId</a> (unsigned int id)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find connection according to the peer id.  <a href="#caa93ccbbf148971015c04f8b1d4e2b5"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="e823fd6db6437dcd3b06b30f94fd6be8"></a><!-- doxytag: member="Omiscid::TcpServer::SetTcpNoDelay" ref="e823fd6db6437dcd3b06b30f94fd6be8" args="(bool Set=true)" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#e823fd6db6437dcd3b06b30f94fd6be8">SetTcpNoDelay</a> (bool Set=true)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the undelying socket in non buffering mode if possible. <br></td></tr>
<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="class_omiscid_1_1_mutexed_simple_list.html">MutexedSimpleList</a>&lt; <a class="el" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="3022825d7336f08a2d34c8ef4f2b5f06"></a><!-- doxytag: member="Omiscid::TcpServer::ProtectedSend" ref="3022825d7336f08a2d34c8ef4f2b5f06" args="" -->
<a class="el" href="class_omiscid_1_1_mutex.html">Mutex</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#3022825d7336f08a2d34c8ef4f2b5f06">ProtectedSend</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="b52b0e8db8d7b6d087f287cdbc199e54"></a><!-- doxytag: member="Omiscid::TcpServer::BufferForMultipleClients" ref="b52b0e8db8d7b6d087f287cdbc199e54" args="" -->
char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#b52b0e8db8d7b6d087f287cdbc199e54">BufferForMultipleClients</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_omiscid_1_1_tcp_server.html#4b00a5fc5b9f3d1de2487cfc08a1be6e">TcpNoDelayMode</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find connection according to the peer id.  <a href="#4b00a5fc5b9f3d1de2487cfc08a1be6e"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
TCP Server.
<p>
Work on BIP protocol. The message are exchanged between BIP tag. Can receive TCP connection, from TCPClient, telnet. The BIP protocol ask for en exchange of empty message after the connection creation. An empty message is : BIP/1.0 pppppppp 00000000 00000000 \r\n\r\n where pppppppp is a hexadecimal representation of the id of the client<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Sebastien Pesnel </dd></dl>

<p>

<p>
Definition at line <a class="el" href="_tcp_server_8h-source.html#l00032">32</a> of file <a class="el" href="_tcp_server_8h-source.html">TcpServer.h</a>.<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="bc977059ef61f1c42f5fda1bc5945ab0"></a><!-- doxytag: member="Omiscid::TcpServer::TcpServer" ref="bc977059ef61f1c42f5fda1bc5945ab0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TcpServer::TcpServer           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Constructor.
<p>
Build a TCP socket
<p>
Definition at line <a class="el" href="_tcp_server_8cpp-source.html#l00007">7</a> of file <a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a>.
<p>
References <a class="el" href="_tcp_server_8h-source.html#l00190">BufferForMultipleClients</a>, <a class="el" href="_system_2_system_2_config_8h-source.html#l00209">OMISCID_TLM</a>, and <a class="el" href="_socket_8h-source.html#l00019">TCP_BUFFER_SIZE</a>.<div class="fragment"><pre class="fragment"><a name="l00008"></a>00008 : <a class="code" href="class_omiscid_1_1_msg_socket.html#7ce223225245ecb8b90d7344f86c2bd6">MsgSocket</a>(Socket::TCP), <a class="code" href="class_omiscid_1_1_tcp_server.html#4b00a5fc5b9f3d1de2487cfc08a1be6e">TcpNoDelayMode</a>(<span class="keyword">false</span>)
<a name="l00009"></a>00009 {
<a name="l00010"></a>00010     <a class="code" href="class_omiscid_1_1_tcp_server.html#b52b0e8db8d7b6d087f287cdbc199e54">BufferForMultipleClients</a> = <span class="keyword">new</span> <a class="code" href="_system_2_system_2_config_8h.html#87a9b7794230e905ae0170f5782a08cd">OMISCID_TLM</a> <span class="keywordtype">char</span>[<a class="code" href="_socket_8h.html#02ded67c60c79f3a121a19a495bde2fe">TCP_BUFFER_SIZE</a>];
<a name="l00011"></a>00011 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="2051315b5ad937b3f1a67f17a6f130e7"></a><!-- doxytag: member="Omiscid::TcpServer::TcpServer" ref="2051315b5ad937b3f1a67f17a6f130e7" args="(int port, int pid=0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TcpServer::TcpServer           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>port</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pid</em> = <code>0</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Constructor.
<p>
Build a TCP socket ans then call Create with the parameter port. <dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="class_omiscid_1_1_tcp_server.html#319287ed5b4e36cfdc8cf77dc0c0f822">Create</a> </dd></dl>

<p>
Definition at line <a class="el" href="_tcp_server_8cpp-source.html#l00013">13</a> of file <a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a>.
<p>
References <a class="el" href="_tcp_server_8h-source.html#l00190">BufferForMultipleClients</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00033">Create()</a>, <a class="el" href="_system_2_system_2_config_8h-source.html#l00209">OMISCID_TLM</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00446">SetServiceId()</a>, and <a class="el" href="_socket_8h-source.html#l00019">TCP_BUFFER_SIZE</a>.<div class="fragment"><pre class="fragment"><a name="l00014"></a>00014 : <a class="code" href="class_omiscid_1_1_msg_socket.html#7ce223225245ecb8b90d7344f86c2bd6">MsgSocket</a>(Socket::TCP), <a class="code" href="class_omiscid_1_1_tcp_server.html#4b00a5fc5b9f3d1de2487cfc08a1be6e">TcpNoDelayMode</a>(<span class="keyword">false</span>)
<a name="l00015"></a>00015 {
<a name="l00016"></a>00016     <a class="code" href="class_omiscid_1_1_tcp_server.html#b52b0e8db8d7b6d087f287cdbc199e54">BufferForMultipleClients</a> = <span class="keyword">new</span> <a class="code" href="_system_2_system_2_config_8h.html#87a9b7794230e905ae0170f5782a08cd">OMISCID_TLM</a> <span class="keywordtype">char</span>[<a class="code" href="_socket_8h.html#02ded67c60c79f3a121a19a495bde2fe">TCP_BUFFER_SIZE</a>];
<a name="l00017"></a>00017     <a class="code" href="class_omiscid_1_1_tcp_server.html#6843802ccb0192190d48ebb5b3a2efb8">SetServiceId</a>(pid);
<a name="l00018"></a>00018     <a class="code" href="class_omiscid_1_1_tcp_server.html#319287ed5b4e36cfdc8cf77dc0c0f822">Create</a>(port);
<a name="l00019"></a>00019 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="728a9e31c53cf86887f1f6149b1c46dd"></a><!-- doxytag: member="Omiscid::TcpServer::~TcpServer" ref="728a9e31c53cf86887f1f6149b1c46dd" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TcpServer::~TcpServer           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Destructor.
<p>
Call Disconnect and Close, and so destroy all the connections. <dl class="see" compact><dt><b>See also:</b></dt><dd><a class="el" href="class_omiscid_1_1_tcp_server.html#0fab90d0581d4bf34ed8bc433bccb040">Disconnect</a>, <a class="el" href="class_omiscid_1_1_tcp_server.html#0b357d7c75aa9892953bbd20b2687f9d">Close</a> </dd></dl>

<p>
Definition at line <a class="el" href="_tcp_server_8cpp-source.html#l00021">21</a> of file <a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a>.
<p>
References <a class="el" href="_tcp_server_8h-source.html#l00190">BufferForMultipleClients</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00052">Close()</a>, and <a class="el" href="_tcp_server_8cpp-source.html#l00039">Disconnect()</a>.<div class="fragment"><pre class="fragment"><a name="l00022"></a>00022 {
<a name="l00023"></a>00023     <a class="code" href="class_omiscid_1_1_tcp_server.html#0fab90d0581d4bf34ed8bc433bccb040">Disconnect</a>();
<a name="l00024"></a>00024     <a class="code" href="class_omiscid_1_1_tcp_server.html#0b357d7c75aa9892953bbd20b2687f9d">Close</a>();
<a name="l00025"></a>00025
<a name="l00026"></a>00026     <span class="keywordflow">if</span> ( <a class="code" href="class_omiscid_1_1_tcp_server.html#b52b0e8db8d7b6d087f287cdbc199e54">BufferForMultipleClients</a> )
<a name="l00027"></a>00027     {
<a name="l00028"></a>00028         <span class="keyword">delete</span> [] <a class="code" href="class_omiscid_1_1_tcp_server.html#b52b0e8db8d7b6d087f287cdbc199e54">BufferForMultipleClients</a>;
<a name="l00029"></a>00029         <a class="code" href="class_omiscid_1_1_tcp_server.html#b52b0e8db8d7b6d087f287cdbc199e54">BufferForMultipleClients</a> = NULL;
<a name="l00030"></a>00030     }
<a name="l00031"></a>00031 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="319287ed5b4e36cfdc8cf77dc0c0f822"></a><!-- doxytag: member="Omiscid::TcpServer::Create" ref="319287ed5b4e36cfdc8cf77dc0c0f822" args="(int port=0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TcpServer::Create           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>port</em> = <code>0</code>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Lauch the TCP Server.
<p>
Bind the socket on the port 'port' and wait for client connections. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>port</em>&nbsp;</td><td>[in] port where connect. If port equals 0, a free port is automatically chosen. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="_tcp_server_8cpp-source.html#l00033">33</a> of file <a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a>.
<p>
References <a class="el" href="_msg_socket_8cpp-source.html#l00390">Omiscid::MsgSocket::InitForTcpServer()</a>, and <a class="el" href="_thread_8cpp-source.html#l00044">Omiscid::Thread::StartThread()</a>.
<p>
Referenced by <a class="el" href="_connector_8cpp-source.html#l00041">Omiscid::Connector::Create()</a>, <a class="el" href="_control_server_8cpp-source.html#l00154">Omiscid::ControlServer::StartServer()</a>, and <a class="el" href="_tcp_server_8cpp-source.html#l00013">TcpServer()</a>.<div class="fragment"><pre class="fragment"><a name="l00034"></a>00034 {
<a name="l00035"></a>00035     <a class="code" href="class_omiscid_1_1_msg_socket.html#91aca9a8ded8f7a4801aa4c6e462bdda">InitForTcpServer</a>(port);
<a name="l00036"></a>00036     <a class="code" href="class_omiscid_1_1_thread.html#eb4de8e03ee2008da85d695d64cf8ad6">StartThread</a>();
<a name="l00037"></a>00037 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="55541631515a196a876d1e31b5d3e957"></a><!-- doxytag: member="Omiscid::TcpServer::SendToClient" ref="55541631515a196a876d1e31b5d3e957" args="(int len, const char *buf, unsigned int pid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TcpServer::SendToClient           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>pid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send data to a client.
<p>
Send the 'len' bytes contained in the buffer 'buf' to a client. The client is defined by the void* pointer. reimplemented from Server <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>[in] number of bytes to send. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>[in] buffer with the len bytes to send. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pid</em>&nbsp;</td><td>[in] id of the client to contact. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>number of byte send </dd></dl>

<p>
Definition at line <a class="el" href="_tcp_server_8cpp-source.html#l00058">58</a> of file <a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a>.
<p>
References <a class="el" href="_simple_exception_8h-source.html#l00063">Omiscid::SimpleException::err</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00492">FindClientFromId()</a>, <a class="el" href="_simple_string_8cpp-source.html#l00921">Omiscid::SimpleString::GetStr()</a>, <a class="el" href="_tcp_server_8h-source.html#l00187">listConnections</a>, <a class="el" href="_simple_exception_8h-source.html#l00062">Omiscid::SimpleException::msg</a>, <a class="el" href="_system_2_system_2_config_8h-source.html#l00234">Omiscid::OmiscidTrace()</a>, and <a class="el" href="_msg_socket_8cpp-source.html#l00932">Omiscid::MsgSocket::Send()</a>.
<p>
Referenced by <a class="el" href="_connector_8cpp-source.html#l00297">Omiscid::Connector::SendToPeer()</a>.<div class="fragment"><pre class="fragment"><a name="l00059"></a>00059 {
<a name="l00060"></a>00060     <span class="comment">// OmiscidTrace( "TcpServer::SendToClient\n");</span>
<a name="l00061"></a>00061     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Lock();
<a name="l00062"></a>00062     <a class="code" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a>* ms = <a class="code" href="class_omiscid_1_1_tcp_server.html#caa93ccbbf148971015c04f8b1d4e2b5">FindClientFromId</a>(pid);
<a name="l00063"></a>00063     <span class="keywordtype">int</span> nb_send = 0;
<a name="l00064"></a>00064     <span class="keywordflow">if</span>(ms)
<a name="l00065"></a>00065     {
<a name="l00066"></a>00066         <span class="comment">//ms-&gt;IsConnected()  : tested by FindClientFromId</span>
<a name="l00067"></a>00067         <span class="keywordflow">try</span>
<a name="l00068"></a>00068         {
<a name="l00069"></a>00069             nb_send = ms-&gt;<a class="code" href="class_omiscid_1_1_msg_socket.html#7496fe09ce10bd84eac5ea6e44c8bc31">Send</a>(len, buf);
<a name="l00070"></a>00070         }
<a name="l00071"></a>00071         <span class="keywordflow">catch</span>( <a class="code" href="class_omiscid_1_1_socket_exception.html">SocketException</a> &amp;e )
<a name="l00072"></a>00072         {
<a name="l00073"></a>00073             <a class="code" href="namespace_omiscid.html#75386ddb9b14af103045f0df7c2b2429">OmiscidTrace</a>( <span class="stringliteral">"Error while sending to %8.8x peer : %s (%d)\n"</span>, pid, e.<a class="code" href="class_omiscid_1_1_simple_exception.html#bf3693dcd188f280e72bc861c19188bb">msg</a>.<a class="code" href="class_omiscid_1_1_simple_string.html#073b80f513204da691abc6b2f9b03338">GetStr</a>(), e.<a class="code" href="class_omiscid_1_1_simple_exception.html#25a4d280190281495a5f85fa4dca1319">err</a> );
<a name="l00074"></a>00074         }
<a name="l00075"></a>00075     }
<a name="l00076"></a>00076     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Unlock();
<a name="l00077"></a>00077     <span class="keywordflow">return</span> nb_send;
<a name="l00078"></a>00078 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="c8626847c8c147546061b209d1f1a6c7"></a><!-- doxytag: member="Omiscid::TcpServer::SendToAllClients" ref="c8626847c8c147546061b209d1f1a6c7" args="(int len, const char *buf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TcpServer::SendToAllClients           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>buf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send the 'len' bytes contained in the buffer 'buf' to all clients. reimplemented from Server <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>[in] number of bytes to send. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>[in] buffer with the len bytes to send. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="_tcp_server_8cpp-source.html#l00103">103</a> of file <a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a>.
<p>
References <a class="el" href="_tcp_server_8h-source.html#l00190">BufferForMultipleClients</a>, <a class="el" href="_mutex_8cpp-source.html#l00046">Omiscid::Mutex::EnterMutex()</a>, <a class="el" href="_simple_exception_8h-source.html#l00063">Omiscid::SimpleException::err</a>, <a class="el" href="_simple_string_8cpp-source.html#l00921">Omiscid::SimpleString::GetStr()</a>, <a class="el" href="_msg_socket_8cpp-source.html#l01504">Omiscid::MsgSocket::IsConnected()</a>, <a class="el" href="_mutex_8cpp-source.html#l00069">Omiscid::Mutex::LeaveMutex()</a>, <a class="el" href="_tcp_server_8h-source.html#l00187">listConnections</a>, <a class="el" href="_simple_exception_8h-source.html#l00062">Omiscid::SimpleException::msg</a>, <a class="el" href="_system_2_system_2_config_8h-source.html#l00234">Omiscid::OmiscidTrace()</a>, <a class="el" href="_msg_socket_8cpp-source.html#l00268">Omiscid::MsgSocket::PrepareBufferForBip()</a>, <a class="el" href="_tcp_server_8h-source.html#l00189">ProtectedSend</a>, <a class="el" href="_msg_socket_8cpp-source.html#l00932">Omiscid::MsgSocket::Send()</a>, and <a class="el" href="_msg_socket_8cpp-source.html#l01158">Omiscid::MsgSocket::SendPreparedBuffer()</a>.
<p>
Referenced by <a class="el" href="_connector_8cpp-source.html#l00214">Omiscid::Connector::SendToAll()</a>.<div class="fragment"><pre class="fragment"><a name="l00104"></a>00104 {
<a name="l00105"></a>00105     <span class="keywordtype">int</span> nb_clients = 0;
<a name="l00106"></a>00106     <span class="keywordtype">int</span> TotalLen;
<a name="l00107"></a>00107     <a class="code" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a> * ms;
<a name="l00108"></a>00108
<a name="l00109"></a>00109     <span class="comment">// Check if we have someone to serve</span>
<a name="l00110"></a>00110     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Lock();
<a name="l00111"></a>00111     <span class="keywordflow">if</span> ( <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.GetNumberOfElements() == 0 )
<a name="l00112"></a>00112     {
<a name="l00113"></a>00113         <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Unlock();
<a name="l00114"></a>00114         <span class="keywordflow">return</span> 0;
<a name="l00115"></a>00115     }
<a name="l00116"></a>00116     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Unlock();
<a name="l00117"></a>00117
<a name="l00118"></a>00118     <a class="code" href="class_omiscid_1_1_tcp_server.html#3022825d7336f08a2d34c8ef4f2b5f06">ProtectedSend</a>.<a class="code" href="class_omiscid_1_1_mutex.html#8caff9254f412a46c84075261e325743">EnterMutex</a>();
<a name="l00119"></a>00119
<a name="l00120"></a>00120     <span class="comment">// If message is too big, we do not try to do optimisation</span>
<a name="l00121"></a>00121     <span class="keywordflow">if</span> ( len &gt; maxBIPMessageSize )
<a name="l00122"></a>00122     {
<a name="l00123"></a>00123         <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Lock();
<a name="l00124"></a>00124         <span class="keywordflow">for</span>(<a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.First(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.NotAtEnd(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Next() )
<a name="l00125"></a>00125         {
<a name="l00126"></a>00126             ms = <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.GetCurrent();
<a name="l00127"></a>00127             <span class="keywordflow">if</span>( ms-&gt;<a class="code" href="class_omiscid_1_1_msg_socket.html#21e5b5ec66ef490dec3d957711b91c90">IsConnected</a>() )
<a name="l00128"></a>00128             {
<a name="l00129"></a>00129                 <span class="keywordflow">try</span>
<a name="l00130"></a>00130                 {
<a name="l00131"></a>00131                     ms-&gt;<a class="code" href="class_omiscid_1_1_msg_socket.html#7496fe09ce10bd84eac5ea6e44c8bc31">Send</a>(len, buf);
<a name="l00132"></a>00132                     nb_clients++;
<a name="l00133"></a>00133                 }
<a name="l00134"></a>00134                 <span class="keywordflow">catch</span>( <a class="code" href="class_omiscid_1_1_socket_exception.html">SocketException</a> &amp;e )
<a name="l00135"></a>00135                 {
<a name="l00136"></a>00136                     <a class="code" href="namespace_omiscid.html#75386ddb9b14af103045f0df7c2b2429">OmiscidTrace</a>( <span class="stringliteral">"Error while sending to all peers : %s (%d)\n"</span>, e.<a class="code" href="class_omiscid_1_1_simple_exception.html#bf3693dcd188f280e72bc861c19188bb">msg</a>.<a class="code" href="class_omiscid_1_1_simple_string.html#073b80f513204da691abc6b2f9b03338">GetStr</a>(), e.<a class="code" href="class_omiscid_1_1_simple_exception.html#25a4d280190281495a5f85fa4dca1319">err</a> );
<a name="l00137"></a>00137                 }
<a name="l00138"></a>00138             }
<a name="l00139"></a>00139             <span class="keywordflow">else</span>
<a name="l00140"></a>00140             {
<a name="l00141"></a>00141                 <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.RemoveCurrent();
<a name="l00142"></a>00142                 <span class="keyword">delete</span> ms;
<a name="l00143"></a>00143             }
<a name="l00144"></a>00144         }
<a name="l00145"></a>00145         <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Unlock();
<a name="l00146"></a>00146
<a name="l00147"></a>00147         <a class="code" href="class_omiscid_1_1_tcp_server.html#3022825d7336f08a2d34c8ef4f2b5f06">ProtectedSend</a>.<a class="code" href="class_omiscid_1_1_mutex.html#478cbb03b7704d5c9909e40165748b28">LeaveMutex</a>();
<a name="l00148"></a>00148         <span class="keywordflow">return</span> nb_clients;
<a name="l00149"></a>00149     }
<a name="l00150"></a>00150
<a name="l00151"></a>00151     TotalLen = <a class="code" href="class_omiscid_1_1_msg_socket.html#bd49aef27290642697e6428ec2e07597">MsgSocket::PrepareBufferForBip</a>( <a class="code" href="class_omiscid_1_1_tcp_server.html#b52b0e8db8d7b6d087f287cdbc199e54">BufferForMultipleClients</a>, buf, len );
<a name="l00152"></a>00152     <span class="keywordflow">if</span> ( TotalLen == -1 )
<a name="l00153"></a>00153     {
<a name="l00154"></a>00154         <a class="code" href="class_omiscid_1_1_tcp_server.html#3022825d7336f08a2d34c8ef4f2b5f06">ProtectedSend</a>.<a class="code" href="class_omiscid_1_1_mutex.html#478cbb03b7704d5c9909e40165748b28">LeaveMutex</a>();
<a name="l00155"></a>00155         <span class="keywordflow">return</span> -1;
<a name="l00156"></a>00156     }
<a name="l00157"></a>00157
<a name="l00158"></a>00158     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Lock();
<a name="l00159"></a>00159     <span class="keywordflow">for</span>(<a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.First(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.NotAtEnd(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Next() )
<a name="l00160"></a>00160     {
<a name="l00161"></a>00161         ms = <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.GetCurrent();
<a name="l00162"></a>00162         <span class="keywordflow">if</span>( ms-&gt;<a class="code" href="class_omiscid_1_1_msg_socket.html#21e5b5ec66ef490dec3d957711b91c90">IsConnected</a>() )
<a name="l00163"></a>00163         {
<a name="l00164"></a>00164             <span class="keywordflow">try</span>
<a name="l00165"></a>00165             {
<a name="l00166"></a>00166                 ms-&gt;<a class="code" href="class_omiscid_1_1_msg_socket.html#b80c9ed1145f7d4e42240f6b8de09c0f">SendPreparedBuffer</a>(TotalLen, <a class="code" href="class_omiscid_1_1_tcp_server.html#b52b0e8db8d7b6d087f287cdbc199e54">BufferForMultipleClients</a>);
<a name="l00167"></a>00167                 nb_clients++;
<a name="l00168"></a>00168             }
<a name="l00169"></a>00169             <span class="keywordflow">catch</span>( <a class="code" href="class_omiscid_1_1_socket_exception.html">SocketException</a> &amp;e )
<a name="l00170"></a>00170             {
<a name="l00171"></a>00171                 <a class="code" href="namespace_omiscid.html#75386ddb9b14af103045f0df7c2b2429">OmiscidTrace</a>( <span class="stringliteral">"Error while sending to all peers : %s (%d)\n"</span>, e.<a class="code" href="class_omiscid_1_1_simple_exception.html#bf3693dcd188f280e72bc861c19188bb">msg</a>.<a class="code" href="class_omiscid_1_1_simple_string.html#073b80f513204da691abc6b2f9b03338">GetStr</a>(), e.<a class="code" href="class_omiscid_1_1_simple_exception.html#25a4d280190281495a5f85fa4dca1319">err</a> );
<a name="l00172"></a>00172             }
<a name="l00173"></a>00173         }
<a name="l00174"></a>00174         <span class="keywordflow">else</span>
<a name="l00175"></a>00175         {
<a name="l00176"></a>00176             <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.RemoveCurrent();
<a name="l00177"></a>00177             <span class="keyword">delete</span> ms;
<a name="l00178"></a>00178         }
<a name="l00179"></a>00179     }
<a name="l00180"></a>00180     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Unlock();
<a name="l00181"></a>00181
<a name="l00182"></a>00182     <a class="code" href="class_omiscid_1_1_tcp_server.html#3022825d7336f08a2d34c8ef4f2b5f06">ProtectedSend</a>.<a class="code" href="class_omiscid_1_1_mutex.html#478cbb03b7704d5c9909e40165748b28">LeaveMutex</a>();
<a name="l00183"></a>00183
<a name="l00184"></a>00184     <span class="keywordflow">return</span> nb_clients;
<a name="l00185"></a>00185 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="4ec1f48fa936759a99f28ecd5a0e1b29"></a><!-- doxytag: member="Omiscid::TcpServer::SendToClient" ref="4ec1f48fa936759a99f28ecd5a0e1b29" args="(int *tab_len, const char **tab_buf, int nb_buf, unsigned int pid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TcpServer::SendToClient           </td>
          <td>(</td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>tab_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&nbsp;</td>
          <td class="paramname"> <em>tab_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nb_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>pid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send a cutted message to one client.
<p>
Send a message in several part (on TCP) by using the BIP protocol The parts of the message are sent the one per one, the all message is put between BIP tag. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>tab_len</em>&nbsp;</td><td>[in] array of buffer size : the size of each buffer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tab_buf</em>&nbsp;</td><td>[in] array of buffer : the buffers to send </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nb_buf</em>&nbsp;</td><td>[in] the number of buffer to send : the number of buffer in the array </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pid</em>&nbsp;</td><td>[in] id of the client to contact. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the number of byte send (byte of data + tag) (-1 if error occured) </dd></dl>

<p>
Definition at line <a class="el" href="_tcp_server_8cpp-source.html#l00080">80</a> of file <a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a>.
<p>
References <a class="el" href="_simple_exception_8h-source.html#l00063">Omiscid::SimpleException::err</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00492">FindClientFromId()</a>, <a class="el" href="_simple_string_8cpp-source.html#l00921">Omiscid::SimpleString::GetStr()</a>, <a class="el" href="_tcp_server_8h-source.html#l00187">listConnections</a>, <a class="el" href="_simple_exception_8h-source.html#l00062">Omiscid::SimpleException::msg</a>, <a class="el" href="_system_2_system_2_config_8h-source.html#l00234">Omiscid::OmiscidTrace()</a>, and <a class="el" href="_msg_socket_8cpp-source.html#l01038">Omiscid::MsgSocket::SendCuttedMsg()</a>.<div class="fragment"><pre class="fragment"><a name="l00081"></a>00081 {
<a name="l00082"></a>00082     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Lock();
<a name="l00083"></a>00083
<a name="l00084"></a>00084     <a class="code" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a>* ms = <a class="code" href="class_omiscid_1_1_tcp_server.html#caa93ccbbf148971015c04f8b1d4e2b5">FindClientFromId</a>(pid);
<a name="l00085"></a>00085     <span class="keywordtype">int</span> nb_send = 0;
<a name="l00086"></a>00086
<a name="l00087"></a>00087     <span class="keywordflow">if</span>(ms)
<a name="l00088"></a>00088     {
<a name="l00089"></a>00089         <span class="comment">//ms-&gt;IsConnected() tested by FindClientFromId</span>
<a name="l00090"></a>00090         <span class="keywordflow">try</span>
<a name="l00091"></a>00091         {
<a name="l00092"></a>00092             nb_send = ms-&gt;<a class="code" href="class_omiscid_1_1_msg_socket.html#4a2314b70a47858c24edbaa8636bcbe6">SendCuttedMsg</a>(tab_len, tab_buf, nb_buf);
<a name="l00093"></a>00093         }
<a name="l00094"></a>00094         <span class="keywordflow">catch</span>( <a class="code" href="class_omiscid_1_1_socket_exception.html">SocketException</a> &amp;e )
<a name="l00095"></a>00095         {
<a name="l00096"></a>00096             <a class="code" href="namespace_omiscid.html#75386ddb9b14af103045f0df7c2b2429">OmiscidTrace</a>( <span class="stringliteral">"Error while sending to %8.8x peer : %s (%d)\n"</span>, pid, e.<a class="code" href="class_omiscid_1_1_simple_exception.html#bf3693dcd188f280e72bc861c19188bb">msg</a>.<a class="code" href="class_omiscid_1_1_simple_string.html#073b80f513204da691abc6b2f9b03338">GetStr</a>(), e.<a class="code" href="class_omiscid_1_1_simple_exception.html#25a4d280190281495a5f85fa4dca1319">err</a> );
<a name="l00097"></a>00097         }
<a name="l00098"></a>00098     }
<a name="l00099"></a>00099     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Unlock();
<a name="l00100"></a>00100     <span class="keywordflow">return</span> nb_send;
<a name="l00101"></a>00101 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="3921f222948da678ab255407f9a5a582"></a><!-- doxytag: member="Omiscid::TcpServer::SendToAllClients" ref="3921f222948da678ab255407f9a5a582" args="(int *tab_len, const char **tab_buf, int nb_buf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TcpServer::SendToAllClients           </td>
          <td>(</td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>tab_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&nbsp;</td>
          <td class="paramname"> <em>tab_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nb_buf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send a cutted message to all the clients.
<p>
Send a message in several part (on TCP) by using the BIP protocol The parts of the message are sent the one per one, the all message is put between BIP tag. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>tab_len</em>&nbsp;</td><td>[in] array of buffer size : the size of each buffer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tab_buf</em>&nbsp;</td><td>[in] array of buffer : the buffers to send </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>nb_buf</em>&nbsp;</td><td>[in] the number of buffer to send : the number of buffer in the array </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="_tcp_server_8cpp-source.html#l00187">187</a> of file <a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a>.
<p>
References <a class="el" href="_tcp_server_8h-source.html#l00190">BufferForMultipleClients</a>, <a class="el" href="_mutex_8cpp-source.html#l00046">Omiscid::Mutex::EnterMutex()</a>, <a class="el" href="_simple_exception_8h-source.html#l00063">Omiscid::SimpleException::err</a>, <a class="el" href="_simple_string_8cpp-source.html#l00921">Omiscid::SimpleString::GetStr()</a>, <a class="el" href="_msg_socket_8cpp-source.html#l01504">Omiscid::MsgSocket::IsConnected()</a>, <a class="el" href="_mutex_8cpp-source.html#l00069">Omiscid::Mutex::LeaveMutex()</a>, <a class="el" href="_tcp_server_8h-source.html#l00187">listConnections</a>, <a class="el" href="_simple_exception_8h-source.html#l00062">Omiscid::SimpleException::msg</a>, <a class="el" href="_system_2_system_2_config_8h-source.html#l00234">Omiscid::OmiscidTrace()</a>, <a class="el" href="_msg_socket_8cpp-source.html#l00300">Omiscid::MsgSocket::PrepareBufferForBipFromCuttedMsg()</a>, <a class="el" href="_tcp_server_8h-source.html#l00189">ProtectedSend</a>, <a class="el" href="_msg_socket_8cpp-source.html#l01038">Omiscid::MsgSocket::SendCuttedMsg()</a>, and <a class="el" href="_msg_socket_8cpp-source.html#l01158">Omiscid::MsgSocket::SendPreparedBuffer()</a>.<div class="fragment"><pre class="fragment"><a name="l00188"></a>00188 {
<a name="l00189"></a>00189     <span class="keywordtype">int</span> nb_clients = 0;
<a name="l00190"></a>00190     <span class="keywordtype">int</span> TotalLen;
<a name="l00191"></a>00191     <span class="keywordtype">int</span> i;
<a name="l00192"></a>00192     <a class="code" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a> * ms;
<a name="l00193"></a>00193
<a name="l00194"></a>00194     <span class="comment">// Check if we have someone to serve</span>
<a name="l00195"></a>00195     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Lock();
<a name="l00196"></a>00196     <span class="keywordflow">if</span> ( <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.GetNumberOfElements() == 0 )
<a name="l00197"></a>00197     {
<a name="l00198"></a>00198         <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Unlock();
<a name="l00199"></a>00199         <span class="keywordflow">return</span> 0;
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Unlock();
<a name="l00202"></a>00202
<a name="l00203"></a>00203     <span class="keywordflow">for</span>( i = 0, TotalLen = 0; i &lt; nb_buf; i++ )
<a name="l00204"></a>00204     {
<a name="l00205"></a>00205         TotalLen += tab_len[0];
<a name="l00206"></a>00206     }
<a name="l00207"></a>00207
<a name="l00208"></a>00208     <span class="comment">// If message is too big, we do not try to do optimisation</span>
<a name="l00209"></a>00209     <span class="keywordflow">if</span> ( TotalLen &gt; maxBIPMessageSize )
<a name="l00210"></a>00210     {
<a name="l00211"></a>00211         <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Lock();
<a name="l00212"></a>00212         <span class="keywordflow">for</span>(<a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.First(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.NotAtEnd(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Next() )
<a name="l00213"></a>00213         {
<a name="l00214"></a>00214             ms = <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.GetCurrent();
<a name="l00215"></a>00215             <span class="keywordflow">if</span>( ms-&gt;<a class="code" href="class_omiscid_1_1_msg_socket.html#21e5b5ec66ef490dec3d957711b91c90">IsConnected</a>() )
<a name="l00216"></a>00216             {
<a name="l00217"></a>00217                 <span class="keywordflow">try</span>
<a name="l00218"></a>00218                 {
<a name="l00219"></a>00219                     ms-&gt;<a class="code" href="class_omiscid_1_1_msg_socket.html#4a2314b70a47858c24edbaa8636bcbe6">SendCuttedMsg</a>(tab_len, tab_buf, nb_buf );
<a name="l00220"></a>00220                     nb_clients++;
<a name="l00221"></a>00221                 }
<a name="l00222"></a>00222                 <span class="keywordflow">catch</span>( <a class="code" href="class_omiscid_1_1_socket_exception.html">SocketException</a> &amp;e )
<a name="l00223"></a>00223                 {
<a name="l00224"></a>00224                     <a class="code" href="namespace_omiscid.html#75386ddb9b14af103045f0df7c2b2429">OmiscidTrace</a>( <span class="stringliteral">"Error while sending to all peers : %s (%d)\n"</span>, e.<a class="code" href="class_omiscid_1_1_simple_exception.html#bf3693dcd188f280e72bc861c19188bb">msg</a>.<a class="code" href="class_omiscid_1_1_simple_string.html#073b80f513204da691abc6b2f9b03338">GetStr</a>(), e.<a class="code" href="class_omiscid_1_1_simple_exception.html#25a4d280190281495a5f85fa4dca1319">err</a> );
<a name="l00225"></a>00225                 }
<a name="l00226"></a>00226             }
<a name="l00227"></a>00227             <span class="keywordflow">else</span>
<a name="l00228"></a>00228             {
<a name="l00229"></a>00229                 <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.RemoveCurrent();
<a name="l00230"></a>00230                 <span class="keyword">delete</span> ms;
<a name="l00231"></a>00231             }
<a name="l00232"></a>00232         }
<a name="l00233"></a>00233         <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Unlock();
<a name="l00234"></a>00234
<a name="l00235"></a>00235         <a class="code" href="class_omiscid_1_1_tcp_server.html#3022825d7336f08a2d34c8ef4f2b5f06">ProtectedSend</a>.<a class="code" href="class_omiscid_1_1_mutex.html#478cbb03b7704d5c9909e40165748b28">LeaveMutex</a>();
<a name="l00236"></a>00236         <span class="keywordflow">return</span> nb_clients;
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238
<a name="l00239"></a>00239     <a class="code" href="class_omiscid_1_1_tcp_server.html#3022825d7336f08a2d34c8ef4f2b5f06">ProtectedSend</a>.<a class="code" href="class_omiscid_1_1_mutex.html#8caff9254f412a46c84075261e325743">EnterMutex</a>();
<a name="l00240"></a>00240     TotalLen = <a class="code" href="class_omiscid_1_1_msg_socket.html#0e59a668c2605cd4fae73fdb679dd615">MsgSocket::PrepareBufferForBipFromCuttedMsg</a>( <a class="code" href="class_omiscid_1_1_tcp_server.html#b52b0e8db8d7b6d087f287cdbc199e54">BufferForMultipleClients</a>, tab_len, tab_buf, nb_buf);
<a name="l00241"></a>00241     <span class="keywordflow">if</span> ( TotalLen == -1 )
<a name="l00242"></a>00242     {
<a name="l00243"></a>00243         <a class="code" href="class_omiscid_1_1_tcp_server.html#3022825d7336f08a2d34c8ef4f2b5f06">ProtectedSend</a>.<a class="code" href="class_omiscid_1_1_mutex.html#478cbb03b7704d5c9909e40165748b28">LeaveMutex</a>();
<a name="l00244"></a>00244         <span class="keywordflow">return</span> -1;
<a name="l00245"></a>00245     }
<a name="l00246"></a>00246
<a name="l00247"></a>00247     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Lock();
<a name="l00248"></a>00248     <span class="keywordflow">for</span>(<a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.First(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.NotAtEnd(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Next() )
<a name="l00249"></a>00249     {
<a name="l00250"></a>00250         ms = <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.GetCurrent();
<a name="l00251"></a>00251         <span class="keywordflow">if</span>( ms-&gt;<a class="code" href="class_omiscid_1_1_msg_socket.html#21e5b5ec66ef490dec3d957711b91c90">IsConnected</a>() )
<a name="l00252"></a>00252         {
<a name="l00253"></a>00253             <span class="keywordflow">try</span>
<a name="l00254"></a>00254             {
<a name="l00255"></a>00255                 ms-&gt;<a class="code" href="class_omiscid_1_1_msg_socket.html#b80c9ed1145f7d4e42240f6b8de09c0f">SendPreparedBuffer</a>(TotalLen, <a class="code" href="class_omiscid_1_1_tcp_server.html#b52b0e8db8d7b6d087f287cdbc199e54">BufferForMultipleClients</a>);
<a name="l00256"></a>00256                 nb_clients++;
<a name="l00257"></a>00257             }
<a name="l00258"></a>00258             <span class="keywordflow">catch</span>( <a class="code" href="class_omiscid_1_1_socket_exception.html">SocketException</a> &amp;e )
<a name="l00259"></a>00259             {
<a name="l00260"></a>00260                 <a class="code" href="namespace_omiscid.html#75386ddb9b14af103045f0df7c2b2429">OmiscidTrace</a>( <span class="stringliteral">"Error while sending to all peers : %s (%d)\n"</span>, e.<a class="code" href="class_omiscid_1_1_simple_exception.html#bf3693dcd188f280e72bc861c19188bb">msg</a>.<a class="code" href="class_omiscid_1_1_simple_string.html#073b80f513204da691abc6b2f9b03338">GetStr</a>(), e.<a class="code" href="class_omiscid_1_1_simple_exception.html#25a4d280190281495a5f85fa4dca1319">err</a> );
<a name="l00261"></a>00261             }
<a name="l00262"></a>00262         }
<a name="l00263"></a>00263         <span class="keywordflow">else</span>
<a name="l00264"></a>00264         {
<a name="l00265"></a>00265             <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.RemoveCurrent();
<a name="l00266"></a>00266             <span class="keyword">delete</span> ms;
<a name="l00267"></a>00267         }
<a name="l00268"></a>00268     }
<a name="l00269"></a>00269     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Unlock();
<a name="l00270"></a>00270
<a name="l00271"></a>00271     <a class="code" href="class_omiscid_1_1_tcp_server.html#3022825d7336f08a2d34c8ef4f2b5f06">ProtectedSend</a>.<a class="code" href="class_omiscid_1_1_mutex.html#478cbb03b7704d5c9909e40165748b28">LeaveMutex</a>();
<a name="l00272"></a>00272
<a name="l00273"></a>00273     <span class="keywordflow">return</span> nb_clients;
<a name="l00274"></a>00274 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="826ff4bb9524d87d88893cd3740f1c83"></a><!-- doxytag: member="Omiscid::TcpServer::GetNbConnections" ref="826ff4bb9524d87d88893cd3740f1c83" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TcpServer::GetNbConnections           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Current number of connections.
<p>
reimplemented from Server <dl class="return" compact><dt><b>Returns:</b></dt><dd>the number of connected client </dd></dl>

<p>
Definition at line <a class="el" href="_tcp_server_8cpp-source.html#l00277">277</a> of file <a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a>.
<p>
References <a class="el" href="_msg_socket_8cpp-source.html#l01504">Omiscid::MsgSocket::IsConnected()</a>, and <a class="el" href="_tcp_server_8h-source.html#l00187">listConnections</a>.
<p>
Referenced by <a class="el" href="_connector_8cpp-source.html#l00518">Omiscid::Connector::GetNbConnection()</a>.<div class="fragment"><pre class="fragment"><a name="l00278"></a>00278 {
<a name="l00279"></a>00279     <a class="code" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a> * ms;
<a name="l00280"></a>00280
<a name="l00281"></a>00281     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Lock();
<a name="l00282"></a>00282     <span class="keywordflow">for</span>(<a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.First(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.NotAtEnd(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Next())
<a name="l00283"></a>00283     {
<a name="l00284"></a>00284         ms = <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.GetCurrent();
<a name="l00285"></a>00285         <span class="keywordflow">if</span>( !ms-&gt;<a class="code" href="class_omiscid_1_1_msg_socket.html#21e5b5ec66ef490dec3d957711b91c90">IsConnected</a>() )
<a name="l00286"></a>00286         {
<a name="l00287"></a>00287             <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.RemoveCurrent();
<a name="l00288"></a>00288             <span class="keyword">delete</span> ms;
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290     }
<a name="l00291"></a>00291
<a name="l00292"></a>00292     <span class="keywordtype">int</span> nb = (int)<a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.GetNumberOfElements();
<a name="l00293"></a>00293     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Unlock();
<a name="l00294"></a>00294     <span class="keywordflow">return</span> nb;
<a name="l00295"></a>00295 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="bcdbecbc9f2dc8451856557925e72d4c"></a><!-- doxytag: member="Omiscid::TcpServer::AcceptConnection" ref="bcdbecbc9f2dc8451856557925e72d4c" args="(MsgSocket *msgsocket)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TcpServer::AcceptConnection           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a> *&nbsp;</td>
          <td class="paramname"> <em>msgsocket</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Accept a new TCP Connection.
<p>
Call for each new connection. (reimplemented from <a class="el" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a>) <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>msgsocket</em>&nbsp;</td><td>[in] object <a class="el" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a> associated to the new connection. </td></tr>
  </table>
</dl>

<p>
Reimplemented from <a class="el" href="class_omiscid_1_1_msg_socket.html#626bf84517ed66dd14358ba09da0dac4">Omiscid::MsgSocket</a>.
<p>
Definition at line <a class="el" href="_tcp_server_8cpp-source.html#l00297">297</a> of file <a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a>.
<p>
References <a class="el" href="_msg_socket_8cpp-source.html#l00417">Omiscid::MsgSocket::AddCallbackObject()</a>, <a class="el" href="_msg_socket_8h-source.html#l00392">Omiscid::MsgSocket::CallbackObjects</a>, <a class="el" href="_msg_socket_8h-source.html#l00397">Omiscid::MsgSocket::callbackSyncLinkData</a>, <a class="el" href="_msg_socket_8h-source.html#l00396">Omiscid::MsgSocket::callbackSyncLinkFct</a>, <a class="el" href="_mutex_8cpp-source.html#l00046">Omiscid::Mutex::EnterMutex()</a>, <a class="el" href="_simple_string_8cpp-source.html#l00926">Omiscid::SimpleString::GetLength()</a>, <a class="el" href="_msg_socket_8cpp-source.html#l01557">Omiscid::MsgSocket::GetMaxMessageSizeForTCP()</a>, <a class="el" href="_msg_socket_8cpp-source.html#l00177">Omiscid::MsgSocket::GetName()</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00586">GetServiceId()</a>, <a class="el" href="_mutex_8cpp-source.html#l00069">Omiscid::Mutex::LeaveMutex()</a>, <a class="el" href="_tcp_server_8h-source.html#l00187">listConnections</a>, <a class="el" href="_msg_socket_8h-source.html#l00395">Omiscid::MsgSocket::mutex</a>, <a class="el" href="_msg_socket_8cpp-source.html#l00502">Omiscid::MsgSocket::SendSyncLinkMsg()</a>, <a class="el" href="_msg_socket_8cpp-source.html#l00488">Omiscid::MsgSocket::SetCallbackSyncLink()</a>, <a class="el" href="_msg_socket_8cpp-source.html#l01562">Omiscid::MsgSocket::SetMaxMessageSizeForTCP()</a>, <a class="el" href="_msg_socket_8cpp-source.html#l00172">Omiscid::MsgSocket::SetName()</a>, <a class="el" href="_msg_socket_8cpp-source.html#l01509">Omiscid::MsgSocket::SetServiceId()</a>, <a class="el" href="_msg_socket_8cpp-source.html#l00186">Omiscid::MsgSocket::SetSyncLinkData()</a>, <a class="el" href="_msg_socket_8cpp-source.html#l01583">Omiscid::MsgSocket::SetTcpNoDelay()</a>, <a class="el" href="_thread_8cpp-source.html#l00044">Omiscid::Thread::StartThread()</a>, <a class="el" href="_msg_socket_8h-source.html#l00398">Omiscid::MsgSocket::SyncLinkData</a>, <a class="el" href="_tcp_server_8h-source.html#l00197">TcpNoDelayMode</a>, <a class="el" href="_msg_socket_8h-source.html#l00036">Omiscid::MsgSocketCallBackData::userData1</a>, and <a class="el" href="_msg_socket_8h-source.html#l00037">Omiscid::MsgSocketCallBackData::userData2</a>.<div class="fragment"><pre class="fragment"><a name="l00298"></a>00298 {
<a name="l00299"></a>00299     <span class="comment">// OmiscidTrace( "in TcpServer::acceptConnection(MsgSocket*) %u\n", sock-&gt;GetPeerPid());</span>
<a name="l00300"></a>00300
<a name="l00301"></a>00301     <span class="comment">// OmiscidTrace( "TcpServer::AcceptConnection:: connection from (%s)\n", sock-&gt;GetSocket()-&gt;GetConnectedHost().GetStr());</span>
<a name="l00302"></a>00302
<a name="l00303"></a>00303     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Lock();
<a name="l00304"></a>00304
<a name="l00305"></a>00305     <span class="comment">// Init the socket</span>
<a name="l00306"></a>00306     <span class="comment">// REVIEW: Inherit my SyndLink data</span>
<a name="l00307"></a>00307     <a class="code" href="class_omiscid_1_1_msg_socket.html#f8de8404f66db44e0a1beed0d48abb7f">mutex</a>.<a class="code" href="class_omiscid_1_1_mutex.html#8caff9254f412a46c84075261e325743">EnterMutex</a>();
<a name="l00308"></a>00308     <span class="keywordflow">if</span> ( <a class="code" href="class_omiscid_1_1_msg_socket.html#dc2366e1f8bd98228d4b21d9b752610a">SyncLinkData</a>.<a class="code" href="class_omiscid_1_1_simple_string.html#f0898dc53a7e2242d570c25757b6e510">GetLength</a>() != 0 )
<a name="l00309"></a>00309     {
<a name="l00310"></a>00310         sock-&gt;SetSyncLinkData( <a class="code" href="class_omiscid_1_1_msg_socket.html#dc2366e1f8bd98228d4b21d9b752610a">SyncLinkData</a>  );
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312     <span class="comment">// If we have a fonction set to process LincSyncData, set it to the opened connection</span>
<a name="l00313"></a>00313     <span class="keywordflow">if</span> ( <a class="code" href="class_omiscid_1_1_msg_socket.html#eafc599eec5aca8cfeea9727bf984f46">callbackSyncLinkFct</a> )
<a name="l00314"></a>00314     {
<a name="l00315"></a>00315         sock-&gt;SetCallbackSyncLink( <a class="code" href="class_omiscid_1_1_msg_socket.html#eafc599eec5aca8cfeea9727bf984f46">callbackSyncLinkFct</a>, <a class="code" href="class_omiscid_1_1_msg_socket.html#bb8e5097944097a27947a933ca86b2af">callbackSyncLinkData</a>.<a class="code" href="class_omiscid_1_1_msg_socket_call_back_data.html#17ba8ff15c9b3774e5d87614ff90e0a1">userData1</a>, <a class="code" href="class_omiscid_1_1_msg_socket.html#bb8e5097944097a27947a933ca86b2af">callbackSyncLinkData</a>.<a class="code" href="class_omiscid_1_1_msg_socket_call_back_data.html#02be2c2528533e57fa4ddaf5b76a97a8">userData2</a> );
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317     <a class="code" href="class_omiscid_1_1_msg_socket.html#f8de8404f66db44e0a1beed0d48abb7f">mutex</a>.<a class="code" href="class_omiscid_1_1_mutex.html#478cbb03b7704d5c9909e40165748b28">LeaveMutex</a>();
<a name="l00318"></a>00318
<a name="l00319"></a>00319     <span class="comment">// Add all my listener to the new socket</span>
<a name="l00320"></a>00320     <a class="code" href="class_omiscid_1_1_msg_socket.html#0d5c96d03589cdf47a3803ac3365249d">CallbackObjects</a>.Lock();
<a name="l00321"></a>00321     <span class="keywordflow">for</span>( <a class="code" href="class_omiscid_1_1_msg_socket.html#0d5c96d03589cdf47a3803ac3365249d">CallbackObjects</a>.First(); <a class="code" href="class_omiscid_1_1_msg_socket.html#0d5c96d03589cdf47a3803ac3365249d">CallbackObjects</a>.NotAtEnd(); <a class="code" href="class_omiscid_1_1_msg_socket.html#0d5c96d03589cdf47a3803ac3365249d">CallbackObjects</a>.Next() )
<a name="l00322"></a>00322     {
<a name="l00323"></a>00323         <span class="comment">// Add this listener</span>
<a name="l00324"></a>00324         sock-&gt;AddCallbackObject( <a class="code" href="class_omiscid_1_1_msg_socket.html#0d5c96d03589cdf47a3803ac3365249d">CallbackObjects</a>.GetCurrent() );
<a name="l00325"></a>00325     }
<a name="l00326"></a>00326     <a class="code" href="class_omiscid_1_1_msg_socket.html#0d5c96d03589cdf47a3803ac3365249d">CallbackObjects</a>.Unlock();
<a name="l00327"></a>00327
<a name="l00328"></a>00328     sock-&gt;SetTcpNoDelay(<a class="code" href="class_omiscid_1_1_tcp_server.html#4b00a5fc5b9f3d1de2487cfc08a1be6e">TcpNoDelayMode</a>);
<a name="l00329"></a>00329     sock-&gt;SetName(<a class="code" href="class_omiscid_1_1_msg_socket.html#b0c5b480cb6cfbe936453014348e203e">GetName</a>());
<a name="l00330"></a>00330     sock-&gt;SetServiceId(<a class="code" href="class_omiscid_1_1_tcp_server.html#aa8162daf6602a0611e631a5496a9c05">GetServiceId</a>());
<a name="l00331"></a>00331     sock-&gt;SetMaxMessageSizeForTCP(<a class="code" href="class_omiscid_1_1_msg_socket.html#05bbc4fe3091f53c7cf3e9c940267c93">MsgSocket::GetMaxMessageSizeForTCP</a>());
<a name="l00332"></a>00332     sock-&gt;StartThread();
<a name="l00333"></a>00333
<a name="l00334"></a>00334     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Add(sock);
<a name="l00335"></a>00335     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Unlock();
<a name="l00336"></a>00336
<a name="l00337"></a>00337     <span class="comment">// Send empty message information</span>
<a name="l00338"></a>00338     sock-&gt;SendSyncLinkMsg();
<a name="l00339"></a>00339
<a name="l00340"></a>00340     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00341"></a>00341 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="6843802ccb0192190d48ebb5b3a2efb8"></a><!-- doxytag: member="Omiscid::TcpServer::SetServiceId" ref="6843802ccb0192190d48ebb5b3a2efb8" args="(unsigned int pid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TcpServer::SetServiceId           </td>
          <td>(</td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>pid</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Define the service Id used in the header of each sent messages.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pid</em>&nbsp;</td><td>[in] the service id value. </td></tr>
  </table>
</dl>

<p>
Implements <a class="el" href="class_omiscid_1_1_com_tools.html#169969f5691d95632fa8149f6febf8a6">Omiscid::ComTools</a>.
<p>
Reimplemented in <a class="el" href="class_omiscid_1_1_connector.html#f08cf8ae1470bc37400406a97938feb5">Omiscid::Connector</a>.
<p>
Definition at line <a class="el" href="_tcp_server_8cpp-source.html#l00446">446</a> of file <a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a>.
<p>
References <a class="el" href="_tcp_server_8h-source.html#l00187">listConnections</a>, and <a class="el" href="_msg_socket_8cpp-source.html#l01509">Omiscid::MsgSocket::SetServiceId()</a>.
<p>
Referenced by <a class="el" href="_connector_8cpp-source.html#l00184">Omiscid::Connector::SetServiceId()</a>, <a class="el" href="_control_server_8cpp-source.html#l00154">Omiscid::ControlServer::StartServer()</a>, and <a class="el" href="_tcp_server_8cpp-source.html#l00013">TcpServer()</a>.<div class="fragment"><pre class="fragment"><a name="l00447"></a>00447 {
<a name="l00448"></a>00448     <span class="comment">// Check validity of a service Id</span>
<a name="l00449"></a>00449     <span class="keywordflow">if</span> ( (pid &amp; ComTools::CONNECTOR_ID) == 0 )
<a name="l00450"></a>00450     {
<a name="l00451"></a>00451         <span class="comment">// pid = pid | 0xffffff01;</span>
<a name="l00452"></a>00452 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00453"></a>00453 <span class="preprocessor"></span>        <span class="comment">//              fprintf( stderr, "Warning: ConnectorId could not be 0 for TcpServer. Value changes to 1 (PeerId = %8.8x)\n", pid );</span>
<a name="l00454"></a>00454 <span class="preprocessor">#endif</span>
<a name="l00455"></a>00455 <span class="preprocessor"></span>    }
<a name="l00456"></a>00456     <a class="code" href="class_omiscid_1_1_msg_socket.html#7567f7b5736b8363e464cec76a978276">MsgSocket::SetServiceId</a>(pid);
<a name="l00457"></a>00457
<a name="l00458"></a>00458     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Lock();
<a name="l00459"></a>00459     <span class="keywordflow">for</span>(<a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.First(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.NotAtEnd(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Next() )
<a name="l00460"></a>00460     {
<a name="l00461"></a>00461         <span class="keywordflow">if</span>( <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.GetCurrent()-&gt;IsConnected() )
<a name="l00462"></a>00462         {
<a name="l00463"></a>00463             <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.GetCurrent()-&gt;SetServiceId(pid);
<a name="l00464"></a>00464         }
<a name="l00465"></a>00465         <span class="keywordflow">else</span>
<a name="l00466"></a>00466         {
<a name="l00467"></a>00467             <span class="keyword">delete</span> <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.GetCurrent();
<a name="l00468"></a>00468             <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.RemoveCurrent();
<a name="l00469"></a>00469         }
<a name="l00470"></a>00470     }
<a name="l00471"></a>00471     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Unlock();
<a name="l00472"></a>00472 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="aa8162daf6602a0611e631a5496a9c05"></a><!-- doxytag: member="Omiscid::TcpServer::GetServiceId" ref="aa8162daf6602a0611e631a5496a9c05" args="() const" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int TcpServer::GetServiceId           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"> const<code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Access to the service id.
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the service id </dd></dl>

<p>
Implements <a class="el" href="class_omiscid_1_1_com_tools.html#ddc5ad89780a0ba79e31c0f779f307ba">Omiscid::ComTools</a>.
<p>
Reimplemented in <a class="el" href="class_omiscid_1_1_connector.html#7590581670e089568b99942dc2acd07b">Omiscid::Connector</a>, and <a class="el" href="class_omiscid_1_1_control_server.html#15bfb89e86b621a8b7810807866a16f9">Omiscid::ControlServer</a>.
<p>
Definition at line <a class="el" href="_tcp_server_8cpp-source.html#l00586">586</a> of file <a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a>.
<p>
References <a class="el" href="_msg_socket_8cpp-source.html#l01514">Omiscid::MsgSocket::GetServiceId()</a>.
<p>
Referenced by <a class="el" href="_tcp_server_8cpp-source.html#l00297">AcceptConnection()</a>, and <a class="el" href="_connector_8cpp-source.html#l00617">Omiscid::Connector::GetServiceId()</a>.<div class="fragment"><pre class="fragment"><a name="l00587"></a>00587 {
<a name="l00588"></a>00588     <span class="keywordflow">return</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#57d1272213afd2f1efef7c01fae4705e">MsgSocket::GetServiceId</a>();
<a name="l00589"></a>00589 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9a6dfaf0c6a8e7348c8c7d96da133d56"></a><!-- doxytag: member="Omiscid::TcpServer::GetListPeerId" ref="9a6dfaf0c6a8e7348c8c7d96da133d56" args="(SimpleList&lt; unsigned int &gt; &amp;list_peer)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TcpServer::GetListPeerId           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_omiscid_1_1_simple_list.html">SimpleList</a>&lt; unsigned int &gt; &amp;&nbsp;</td>
          <td class="paramname"> <em>list_peer</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get the list of id of the service connected to the server. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>list_peer</em>&nbsp;</td><td>[out] received the list of the ids. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the number of id listed in list_peer </dd></dl>

<p>
Implements <a class="el" href="class_omiscid_1_1_com_tools.html#610c5ad85237e82d2d05f3169f7cd903">Omiscid::ComTools</a>.
<p>
Reimplemented in <a class="el" href="class_omiscid_1_1_connector.html#12d389fb6bcee1d43ae4ef20c57a1549">Omiscid::Connector</a>.
<p>
Definition at line <a class="el" href="_tcp_server_8cpp-source.html#l00422">422</a> of file <a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a>.
<p>
References <a class="el" href="_simple_list_8h-source.html#l00217">Omiscid::SimpleList&lt; TYPE &gt;::Add()</a>, <a class="el" href="_msg_socket_8cpp-source.html#l01519">Omiscid::MsgSocket::GetPeerPid()</a>, <a class="el" href="_msg_socket_8cpp-source.html#l01504">Omiscid::MsgSocket::IsConnected()</a>, and <a class="el" href="_tcp_server_8h-source.html#l00187">listConnections</a>.
<p>
Referenced by <a class="el" href="_connector_8cpp-source.html#l00534">Omiscid::Connector::GetListPeerId()</a>.<div class="fragment"><pre class="fragment"><a name="l00423"></a>00423 {
<a name="l00424"></a>00424     <a class="code" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a> * ms;
<a name="l00425"></a>00425     <span class="keywordtype">int</span> nb = 0;
<a name="l00426"></a>00426
<a name="l00427"></a>00427     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Lock();
<a name="l00428"></a>00428     <span class="keywordflow">for</span>(<a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.First(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.NotAtEnd(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Next() )
<a name="l00429"></a>00429     {
<a name="l00430"></a>00430         ms = <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.GetCurrent();
<a name="l00431"></a>00431         <span class="keywordflow">if</span>( !ms-&gt;<a class="code" href="class_omiscid_1_1_msg_socket.html#21e5b5ec66ef490dec3d957711b91c90">IsConnected</a>() )
<a name="l00432"></a>00432         {
<a name="l00433"></a>00433             <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.RemoveCurrent();
<a name="l00434"></a>00434             <span class="keyword">delete</span> ms;
<a name="l00435"></a>00435         }
<a name="l00436"></a>00436         <span class="keywordflow">else</span>
<a name="l00437"></a>00437         {
<a name="l00438"></a>00438             list_peer.<a class="code" href="class_omiscid_1_1_simple_list.html#4504f0e0f3fb158d00b90c714d947bb6">Add</a>(ms-&gt;<a class="code" href="class_omiscid_1_1_msg_socket.html#3426f728c7e5b7e37376dc9ccc0f4d42">GetPeerPid</a>());
<a name="l00439"></a>00439             nb++;
<a name="l00440"></a>00440         }
<a name="l00441"></a>00441     }
<a name="l00442"></a>00442     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Unlock();
<a name="l00443"></a>00443     <span class="keywordflow">return</span> nb;
<a name="l00444"></a>00444 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="c6a92b461be318d0509e0936c51ade6d"></a><!-- doxytag: member="Omiscid::TcpServer::GetTcpPort" ref="c6a92b461be318d0509e0936c51ade6d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned short TcpServer::GetTcpPort           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Access to the port number.
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the port number where the server is listening </dd></dl>

<p>
Reimplemented from <a class="el" href="class_omiscid_1_1_com_tools.html#d0ee9608bb2e157761fd0857083b600c">Omiscid::ComTools</a>.
<p>
Reimplemented in <a class="el" href="class_omiscid_1_1_connector.html#d7f28167c7115cf3b147c2b494fb9ece">Omiscid::Connector</a>.
<p>
Definition at line <a class="el" href="_tcp_server_8cpp-source.html#l00591">591</a> of file <a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a>.
<p>
References <a class="el" href="_msg_socket_8cpp-source.html#l01484">Omiscid::MsgSocket::GetPortNb()</a>.
<p>
Referenced by <a class="el" href="_connector_8cpp-source.html#l00612">Omiscid::Connector::GetTcpPort()</a>.<div class="fragment"><pre class="fragment"><a name="l00592"></a>00592 {
<a name="l00593"></a>00593     <span class="keywordflow">return</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#3086ca374b34ad3981a351cb75a21e4d">MsgSocket::GetPortNb</a>();
<a name="l00594"></a>00594 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="67ee8db36b2ad5308a70c3c7119fef02"></a><!-- doxytag: member="Omiscid::TcpServer::Cast" ref="67ee8db36b2ad5308a70c3c7119fef02" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_omiscid_1_1_com_tools.html">ComTools</a> * TcpServer::Cast           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Cast in <a class="el" href="class_omiscid_1_1_com_tools.html">ComTools</a>.
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the Comtool pointer on an object that derived Comtool </dd></dl>

<p>
Implements <a class="el" href="class_omiscid_1_1_com_tools.html#a2ea198596c2e4fc88d77896fb196418">Omiscid::ComTools</a>.
<p>
Reimplemented in <a class="el" href="class_omiscid_1_1_connector.html#a6c860f1ce5faf966e080fa657cfae40">Omiscid::Connector</a>.
<p>
Definition at line <a class="el" href="_tcp_server_8cpp-source.html#l00581">581</a> of file <a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a>.<div class="fragment"><pre class="fragment"><a name="l00582"></a>00582 {
<a name="l00583"></a>00583     <span class="keywordflow">return</span> dynamic_cast&lt;ComTools*&gt;(<span class="keyword">this</span>);
<a name="l00584"></a>00584 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="9db05c42a092a2a224f8130ec925249f"></a><!-- doxytag: member="Omiscid::TcpServer::IsStillConnected" ref="9db05c42a092a2a224f8130ec925249f" args="(unsigned int peer_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool TcpServer::IsStillConnected           </td>
          <td>(</td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>peer_id</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Test if a peer is always connected
<p>
Definition at line <a class="el" href="_tcp_server_8cpp-source.html#l00601">601</a> of file <a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a>.
<p>
References <a class="el" href="_tcp_server_8cpp-source.html#l00492">FindClientFromId()</a>, and <a class="el" href="_tcp_server_8h-source.html#l00187">listConnections</a>.<div class="fragment"><pre class="fragment"><a name="l00602"></a>00602 {
<a name="l00603"></a>00603     <span class="keywordtype">bool</span> res = <span class="keyword">false</span>;
<a name="l00604"></a>00604     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Lock();
<a name="l00605"></a>00605     res = <a class="code" href="class_omiscid_1_1_tcp_server.html#caa93ccbbf148971015c04f8b1d4e2b5">FindClientFromId</a>(peer_id) != NULL;
<a name="l00606"></a>00606     <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Unlock();
<a name="l00607"></a>00607     <span class="keywordflow">return</span> res;
<a name="l00608"></a>00608 }
</pre></div>
<p>

</div>
</div><p>
<a class="anchor" name="caa93ccbbf148971015c04f8b1d4e2b5"></a><!-- doxytag: member="Omiscid::TcpServer::FindClientFromId" ref="caa93ccbbf148971015c04f8b1d4e2b5" args="(unsigned int id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a> * TcpServer::FindClientFromId           </td>
          <td>(</td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>id</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Find connection according to the peer id.
<p>
The list of connection is not locked during the research for the id. Test if the object is connected before returned it : if not, then remove ot and return NULL. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>id</em>&nbsp;</td><td>[in] the value of the wanted peer id </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>NULL if not found, else the <a class="el" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a> connected to the peer id. </dd></dl>

<p>
Definition at line <a class="el" href="_tcp_server_8cpp-source.html#l00492">492</a> of file <a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a>.
<p>
References <a class="el" href="_msg_socket_8cpp-source.html#l01519">Omiscid::MsgSocket::GetPeerPid()</a>, <a class="el" href="_msg_socket_8cpp-source.html#l01504">Omiscid::MsgSocket::IsConnected()</a>, and <a class="el" href="_tcp_server_8h-source.html#l00187">listConnections</a>.
<p>
Referenced by <a class="el" href="_tcp_server_8cpp-source.html#l00601">IsStillConnected()</a>, <a class="el" href="_control_server_8cpp-source.html#l00389">Omiscid::ControlServer::ProcessAMessage()</a>, and <a class="el" href="_tcp_server_8cpp-source.html#l00058">SendToClient()</a>.<div class="fragment"><pre class="fragment"><a name="l00493"></a>00493 {
<a name="l00494"></a>00494     <a class="code" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a> * ms;
<a name="l00495"></a>00495
<a name="l00496"></a>00496     <span class="keywordflow">for</span>( <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.First(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.NotAtEnd(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Next() )
<a name="l00497"></a>00497     {
<a name="l00498"></a>00498         ms = <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.GetCurrent();
<a name="l00499"></a>00499         <span class="keywordflow">if</span>( *ms == <span class="keywordtype">id</span> )
<a name="l00500"></a>00500         {
<a name="l00501"></a>00501             <span class="keywordflow">if</span>( ms-&gt;<a class="code" href="class_omiscid_1_1_msg_socket.html#21e5b5ec66ef490dec3d957711b91c90">IsConnected</a>() )
<a name="l00502"></a>00502             {
<a name="l00503"></a>00503                 <span class="keywordflow">return</span> ms;
<a name="l00504"></a>00504             }
<a name="l00505"></a>00505             <span class="keywordflow">else</span>
<a name="l00506"></a>00506             {
<a name="l00507"></a>00507                 <span class="keyword">delete</span> <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.GetCurrent();
<a name="l00508"></a>00508                 <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.RemoveCurrent();
<a name="l00509"></a>00509                 <span class="comment">// look forward to look if there is not another pid</span>
<a name="l00510"></a>00510             }
<a name="l00511"></a>00511         }
<a name="l00512"></a>00512     }
<a name="l00513"></a>00513
<a name="l00514"></a>00514     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> SearchId = <span class="keywordtype">id</span> &amp; ComTools::SERVICE_PEERID;
<a name="l00515"></a>00515
<a name="l00516"></a>00516     <span class="keywordflow">for</span>( <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.First(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.NotAtEnd(); <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.Next() )
<a name="l00517"></a>00517     {
<a name="l00518"></a>00518         ms = <a class="code" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">listConnections</a>.GetCurrent();
<a name="l00519"></a>00519         <span class="keywordflow">if</span>( SearchId == (ms-&gt;<a class="code" href="class_omiscid_1_1_msg_socket.html#3426f728c7e5b7e37376dc9ccc0f4d42">GetPeerPid</a>() &amp; ComTools::SERVICE_PEERID) )
<a name="l00520"></a>00520         {
<a name="l00521"></a>00521             <span class="keywordflow">if</span> ( ms-&gt;<a class="code" href="class_omiscid_1_1_msg_socket.html#21e5b5ec66ef490dec3d957711b91c90">IsConnected</a>() )
<a name="l00522"></a>00522             {
<a name="l00523"></a>00523                 <span class="keywordflow">return</span> ms;
<a name="l00524"></a>00524             }
<a name="l00525"></a>00525         }
<a name="l00526"></a>00526     }
<a name="l00527"></a>00527
<a name="l00528"></a>00528     <span class="keywordflow">return</span> NULL;
<a name="l00529"></a>00529 }
</pre></div>
<p>

</div>
</div><p>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="3ecdc7f7288bc477b9a587cbbc5b99af"></a><!-- doxytag: member="Omiscid::TcpServer::listConnections" ref="3ecdc7f7288bc477b9a587cbbc5b99af" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_omiscid_1_1_mutexed_simple_list.html">MutexedSimpleList</a>&lt;<a class="el" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a>*&gt; <a class="el" href="class_omiscid_1_1_tcp_server.html#3ecdc7f7288bc477b9a587cbbc5b99af">Omiscid::TcpServer::listConnections</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
list of client connections with a mutex inside for access
<p>
Definition at line <a class="el" href="_tcp_server_8h-source.html#l00187">187</a> of file <a class="el" href="_tcp_server_8h-source.html">TcpServer.h</a>.
<p>
Referenced by <a class="el" href="_tcp_server_8cpp-source.html#l00297">AcceptConnection()</a>, <a class="el" href="_connector_8cpp-source.html#l00416">Omiscid::Connector::AcceptConnection()</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00343">AddCallbackObject()</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00039">Disconnect()</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00532">DisconnectPeerId()</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00492">FindClientFromId()</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00422">GetListPeerId()</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00277">GetNbConnections()</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00601">IsStillConnected()</a>, <a class="el" href="_control_server_8cpp-source.html#l00389">Omiscid::ControlServer::ProcessAMessage()</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00400">RemoveAllCallbackObjects()</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00370">RemoveCallbackObject()</a>, <a class="el" href="_connector_8cpp-source.html#l00214">Omiscid::Connector::SendToAll()</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00103">SendToAllClients()</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00058">SendToClient()</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00474">SetMaxMessageSizeForTCP()</a>, <a class="el" href="_tcp_server_8cpp-source.html#l00446">SetServiceId()</a>, and <a class="el" href="_tcp_server_8cpp-source.html#l00560">SetTcpNoDelay()</a>.
</div>
</div><p>
<a class="anchor" name="4b00a5fc5b9f3d1de2487cfc08a1be6e"></a><!-- doxytag: member="Omiscid::TcpServer::TcpNoDelayMode" ref="4b00a5fc5b9f3d1de2487cfc08a1be6e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_omiscid_1_1_tcp_server.html#4b00a5fc5b9f3d1de2487cfc08a1be6e">Omiscid::TcpServer::TcpNoDelayMode</a><code> [protected]</code>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Find connection according to the peer id.
<p>
Added by Doms. We want to save the current TcpNoDelay option value by default, the value is false
<p>
Definition at line <a class="el" href="_tcp_server_8h-source.html#l00197">197</a> of file <a class="el" href="_tcp_server_8h-source.html">TcpServer.h</a>.
<p>
Referenced by <a class="el" href="_tcp_server_8cpp-source.html#l00297">AcceptConnection()</a>, and <a class="el" href="_tcp_server_8cpp-source.html#l00560">SetTcpNoDelay()</a>.
</div>
</div><p>
<hr>The documentation for this class was generated from the following files:<ul>
<li>Com/Com/<a class="el" href="_tcp_server_8h-source.html">TcpServer.h</a><li>Com/<a class="el" href="_tcp_server_8cpp-source.html">TcpServer.cpp</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Fri Aug 31 13:02:55 2007 for OMiSCID(aka O3MiSCID) by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
