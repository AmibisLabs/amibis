<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OMiSCID(aka O3MiSCID): Com/Com/MsgSocket.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.6 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_91ca07cacb3b6cc00d73f1a780e643c0.html">Com</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_9389b50dd84b62a6e6e3991517237b97.html">Com</a></div>
<h1>MsgSocket.h</h1><a href="_msg_socket_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00008"></a>00008 <span class="preprocessor">#ifndef __MSG_SOCKET_H__</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span><span class="preprocessor">#define __MSG_SOCKET_H__</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;<a class="code" href="_com_2_com_2_config_8h.html">Com/Config.h</a>&gt;</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;<a class="code" href="_thread_8h.html">System/Thread.h</a>&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;<a class="code" href="_mutex_8h.html">System/Mutex.h</a>&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;<a class="code" href="_socket_8h.html">System/Socket.h</a>&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;<a class="code" href="_simple_string_8h.html">System/SimpleString.h</a>&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;<a class="code" href="_simple_list_8h.html">System/SimpleList.h</a>&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;<a class="code" href="_message_8h.html">Com/Message.h</a>&gt;</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="keyword">namespace </span>Omiscid {
<a name="l00021"></a>00021 
<a name="l00022"></a><a class="code" href="_msg_socket_8h.html#02ded67c60c79f3a121a19a495bde2fe">00022</a> <span class="preprocessor">#define TCP_BUFFER_SIZE (1&lt;&lt;16)+1 // 64ko</span>
<a name="l00023"></a><a class="code" href="_msg_socket_8h.html#ab35bfe248d0a277ab80183fcf9c8aa4">00023</a> <span class="preprocessor"></span><span class="preprocessor">#define UDP_MAX_MSG_SIZE 1024</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span>
<a name="l00025"></a>00025 <span class="keyword">class </span>MsgSocket;
<a name="l00026"></a>00026 
<a name="l00032"></a><a class="code" href="class_omiscid_1_1_msg_socket_call_back_data.html">00032</a> <span class="keyword">class </span><a class="code" href="class_omiscid_1_1_msg_socket_call_back_data.html">MsgSocketCallBackData</a>
<a name="l00033"></a>00033 {
<a name="l00034"></a>00034 <span class="keyword">public</span>:
<a name="l00035"></a>00035         <span class="comment">// Virtual destructor always</span>
<a name="l00036"></a>00036         <span class="keyword">virtual</span> <a class="code" href="class_omiscid_1_1_msg_socket_call_back_data.html#53273370ec70fcf715af04837463be3c">~MsgSocketCallBackData</a>();
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="class_omiscid_1_1_msg_socket_call_back_data.html#8280558340d705cb00e23e2a7e46cf11">00038</a>   <a class="code" href="class_omiscid_1_1_message.html">Message</a> <a class="code" href="class_omiscid_1_1_msg_socket_call_back_data.html#8280558340d705cb00e23e2a7e46cf11">Msg</a>;
<a name="l00039"></a><a class="code" href="class_omiscid_1_1_msg_socket_call_back_data.html#17ba8ff15c9b3774e5d87614ff90e0a1">00039</a>   <span class="keywordtype">void</span>* <a class="code" href="class_omiscid_1_1_msg_socket_call_back_data.html#17ba8ff15c9b3774e5d87614ff90e0a1">userData1</a>;
<a name="l00040"></a><a class="code" href="class_omiscid_1_1_msg_socket_call_back_data.html#02be2c2528533e57fa4ddaf5b76a97a8">00040</a>   <span class="keywordtype">void</span>* <a class="code" href="class_omiscid_1_1_msg_socket_call_back_data.html#02be2c2528533e57fa4ddaf5b76a97a8">userData2</a>;
<a name="l00041"></a>00041 };
<a name="l00042"></a>00042 
<a name="l00048"></a><a class="code" href="class_omiscid_1_1_udp_connection.html">00048</a> <span class="keyword">class </span><a class="code" href="class_omiscid_1_1_udp_connection.html">UdpConnection</a>
<a name="l00049"></a>00049 {
<a name="l00050"></a>00050  <span class="keyword">public</span>:
<a name="l00052"></a>00052   <a class="code" href="class_omiscid_1_1_udp_connection.html#5dac1e8dba79e34b1fc62e06697acb97">UdpConnection</a>();
<a name="l00053"></a>00053 
<a name="l00058"></a>00058   <a class="code" href="class_omiscid_1_1_udp_connection.html#5dac1e8dba79e34b1fc62e06697acb97">UdpConnection</a>(<span class="keyword">const</span> <a class="code" href="class_omiscid_1_1_simple_string.html">SimpleString</a> <a class="code" href="class_omiscid_1_1_udp_connection.html#9921efeb360282fa6aabdf0332c7565c">addr</a>, <span class="keywordtype">int</span> port);
<a name="l00059"></a>00059 
<a name="l00063"></a>00063   <a class="code" href="class_omiscid_1_1_udp_connection.html#5dac1e8dba79e34b1fc62e06697acb97">UdpConnection</a>(<span class="keyword">const</span> <a class="code" href="class_omiscid_1_1_udp_connection.html">UdpConnection</a>&amp; udp_connect);
<a name="l00064"></a>00064 
<a name="l00066"></a>00066   <span class="keyword">virtual</span> <a class="code" href="class_omiscid_1_1_udp_connection.html#0bdfc7d2ee2c2dc040da1ed55ef79c43">~UdpConnection</a>();
<a name="l00067"></a>00067 
<a name="l00072"></a>00072   <span class="keywordtype">bool</span> <a class="code" href="class_omiscid_1_1_udp_connection.html#c028d7aaf755a4c5d0d0f1136a98a9cf">operator==</a>(<span class="keyword">const</span> <a class="code" href="class_omiscid_1_1_udp_connection.html">UdpConnection</a>&amp;) <span class="keyword">const</span>;
<a name="l00073"></a>00073 
<a name="l00079"></a>00079   <span class="keywordtype">void</span> <a class="code" href="class_omiscid_1_1_udp_connection.html#6a870b7e92f2bad9a2c412d055fa4407">SetAddr</a>(<span class="keyword">const</span> <span class="keyword">struct</span> sockaddr_in* <a class="code" href="class_omiscid_1_1_udp_connection.html#9921efeb360282fa6aabdf0332c7565c">addr</a>);
<a name="l00080"></a>00080 
<a name="l00084"></a>00084   <span class="keyword">const</span> <span class="keyword">struct </span>sockaddr_in* <a class="code" href="class_omiscid_1_1_udp_connection.html#13be2d984b0f80bd4716813cbd5dce6f">getAddr</a>() <span class="keyword">const</span>;
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="class_omiscid_1_1_udp_connection.html#9921efeb360282fa6aabdf0332c7565c">00086</a>   <span class="keyword">struct </span>sockaddr_in addr; 
<a name="l00087"></a><a class="code" href="class_omiscid_1_1_udp_connection.html#15b605463c781d70c76ef1ce293efbab">00087</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_omiscid_1_1_udp_connection.html#15b605463c781d70c76ef1ce293efbab">pid</a>; 
<a name="l00088"></a>00088 };
<a name="l00089"></a>00089 
<a name="l00098"></a><a class="code" href="class_omiscid_1_1_msg_socket_callback_object.html">00098</a> <span class="keyword">class </span><a class="code" href="class_omiscid_1_1_msg_socket_callback_object.html">MsgSocketCallbackObject</a>
<a name="l00099"></a>00099 {
<a name="l00100"></a>00100 <span class="keyword">public</span>:
<a name="l00101"></a>00101         <span class="comment">// Virtual destructor always</span>
<a name="l00102"></a>00102         <span class="keyword">virtual</span> <a class="code" href="class_omiscid_1_1_msg_socket_callback_object.html#a674f8c20261605e56d56396a8ca0398">~MsgSocketCallbackObject</a>();
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_omiscid_1_1_msg_socket_callback_object.html#3bb1409387ebd7c74cf46b72dbb40a42">Connected</a>(<a class="code" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a>&amp; ConnectionPoint, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> PeerId);
<a name="l00105"></a>00105         <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_omiscid_1_1_msg_socket_callback_object.html#dcc6582e5b3b1624eec40983321e0d38">Disconnected</a>(<a class="code" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a>&amp; ConnectionPoint, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> PeerId);
<a name="l00106"></a>00106 
<a name="l00107"></a>00107         <span class="keyword">virtual</span> <span class="keywordtype">void</span> Receive(<a class="code" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a>&amp; ConnectionPoint, <a class="code" href="class_omiscid_1_1_msg_socket_call_back_data.html">MsgSocketCallBackData</a>&amp; CallbackData) = 0;
<a name="l00108"></a>00108 };
<a name="l00109"></a>00109 
<a name="l00125"></a><a class="code" href="class_omiscid_1_1_msg_socket.html">00125</a> <span class="keyword">class </span><a class="code" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a> : <span class="keyword">public</span> <a class="code" href="class_omiscid_1_1_thread.html">Thread</a>
<a name="l00126"></a>00126 {
<a name="l00127"></a>00127  <span class="keyword">public</span>:
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00130"></a>00130 <span class="preprocessor"></span>
<a name="l00131"></a>00131          <span class="keyword">enum</span> DEBUGFLAGS
<a name="l00132"></a>00132          {
<a name="l00133"></a>00133                  DBG_NONE               = 0x000000000,
<a name="l00134"></a>00134                  DBG_LINKSYNC   = 0x000000001,
<a name="l00135"></a>00135                  DBG_RECV               = 0x000000002,
<a name="l00136"></a>00136                  DBG_SEND               = 0x000000004,
<a name="l00137"></a>00137                  DBG_ALL                = 0xffffffff
<a name="l00138"></a>00138          };
<a name="l00139"></a>00139          <span class="keyword">static</span> DEBUGFLAGS Debug;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 <span class="preprocessor">#endif</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span>
<a name="l00144"></a><a class="code" href="class_omiscid_1_1_msg_socket.html#755a9ab6299c74f203aec3ae5a4a4c47">00144</a>   <span class="keyword">typedef</span> void (<a class="code" href="group___system.html#gc60d2913661e99429c055edcd4b24562">FUNCTION_CALL_TYPE</a> *<a class="code" href="class_omiscid_1_1_msg_socket.html#755a9ab6299c74f203aec3ae5a4a4c47">Callback_SyncLink</a>)(<a class="code" href="class_omiscid_1_1_msg_socket_call_back_data.html">MsgSocketCallBackData</a>*,<a class="code" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a> *);
<a name="l00145"></a>00145 
<a name="l00147"></a><a class="code" href="class_omiscid_1_1_msg_socket.html#4d9ba56644652acfe0e4f6ade0e9659b">00147</a>   <span class="keyword">enum</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#4d9ba56644652acfe0e4f6ade0e9659b">MsgSocketKind</a>
<a name="l00148"></a>00148     {
<a name="l00149"></a>00149       NONE_KIND = -1,
<a name="l00150"></a>00150       <a class="code" href="class_omiscid_1_1_msg_socket.html#4d9ba56644652acfe0e4f6ade0e9659b37eed2ba19df9c46649c797a72cc2d7f">TCP_CLIENT_KIND</a> = 0, 
<a name="l00151"></a>00151       <a class="code" href="class_omiscid_1_1_msg_socket.html#4d9ba56644652acfe0e4f6ade0e9659b0ecdad184663d729a7c9ab6b9fcc73f5">TCP_SERVER_KIND</a>, 
<a name="l00152"></a><a class="code" href="class_omiscid_1_1_msg_socket.html#4d9ba56644652acfe0e4f6ade0e9659b26b29a312b497622aad9256945d6b8cb">00152</a>       <a class="code" href="class_omiscid_1_1_msg_socket.html#4d9ba56644652acfe0e4f6ade0e9659b26b29a312b497622aad9256945d6b8cb">UDP_EXCHANGE_KIND</a> 
<a name="l00153"></a>00153     };
<a name="l00154"></a>00154   
<a name="l00155"></a>00155  <span class="keyword">public</span>:
<a name="l00162"></a>00162   <a class="code" href="class_omiscid_1_1_msg_socket.html#7ce223225245ecb8b90d7344f86c2bd6">MsgSocket</a>(<a class="code" href="class_omiscid_1_1_socket.html">Socket</a>* s);
<a name="l00163"></a>00163 
<a name="l00171"></a>00171   <a class="code" href="class_omiscid_1_1_msg_socket.html#7ce223225245ecb8b90d7344f86c2bd6">MsgSocket</a>(<a class="code" href="class_omiscid_1_1_socket.html#534fbf67274aee620617b048b84ff86a">Socket::SocketKind</a> type);
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 
<a name="l00175"></a>00175   <span class="keyword">virtual</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#b5b28d057094d058c5445069f087bd93">~MsgSocket</a>();
<a name="l00176"></a>00176   
<a name="l00183"></a>00183   <span class="keywordtype">void</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#c04b57b1d0c89fe9c24ee667ba838ddb">InitForTcpClient</a>(<span class="keyword">const</span> <a class="code" href="class_omiscid_1_1_simple_string.html">SimpleString</a> addr, <span class="keywordtype">int</span> port);
<a name="l00184"></a>00184 
<a name="l00189"></a>00189   <span class="keywordtype">void</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#91aca9a8ded8f7a4801aa4c6e462bdda">InitForTcpServer</a>(<span class="keywordtype">int</span> port);
<a name="l00190"></a>00190   
<a name="l00191"></a>00191 
<a name="l00195"></a>00195   <span class="keywordtype">void</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#568d6346baef454c48105712e402d6bd">InitForUdpExchange</a>(<span class="keywordtype">int</span> port);
<a name="l00196"></a>00196 
<a name="l00200"></a>00200   <span class="keywordtype">bool</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#e6a4e463d7f2b49842a19ef632607b91">AddCallbackObject</a>(<a class="code" href="class_omiscid_1_1_msg_socket_callback_object.html">MsgSocketCallbackObject</a> * CallbackObject);
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   
<a name="l00206"></a>00206   <span class="keywordtype">bool</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#749006fded14bc52f629ffa9cccdacf8">RemoveCallbackObject</a>(<a class="code" href="class_omiscid_1_1_msg_socket_callback_object.html">MsgSocketCallbackObject</a> * CallbackObject);
<a name="l00207"></a>00207 
<a name="l00210"></a>00210   <span class="keywordtype">void</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#cdc438cbf9829f9faceea68bd2535f67">RemoveAllCallbackObjects</a>();
<a name="l00211"></a>00211 
<a name="l00214"></a>00214   <span class="keywordtype">void</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#e23f86137b974c4b6aea0d07997a0bc3">SetName</a>(<span class="keyword">const</span> <a class="code" href="class_omiscid_1_1_simple_string.html">SimpleString</a> NewName); 
<a name="l00215"></a>00215   <span class="keyword">const</span> <a class="code" href="class_omiscid_1_1_simple_string.html">SimpleString</a> <a class="code" href="class_omiscid_1_1_msg_socket.html#b0c5b480cb6cfbe936453014348e203e">GetName</a>();                         
<a name="l00217"></a>00217 
<a name="l00223"></a>00223   <span class="keywordtype">void</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#dcae5a3be1bbfd31d4cbbe820d68a970">SetCallbackSyncLink</a>(<a class="code" href="class_omiscid_1_1_msg_socket.html#755a9ab6299c74f203aec3ae5a4a4c47">Callback_SyncLink</a> cr, <span class="keywordtype">void</span>* user_data1 = NULL, <span class="keywordtype">void</span>* user_data2 = NULL);
<a name="l00224"></a>00224 
<a name="l00231"></a>00231   <span class="keywordtype">void</span> <a class="code" href="group___system.html#gc60d2913661e99429c055edcd4b24562">FUNCTION_CALL_TYPE</a> <a class="code" href="class_omiscid_1_1_msg_socket.html#01ceb5ec9a28d28fcf402acf5c35fbef">Run</a>();
<a name="l00232"></a>00232 
<a name="l00246"></a>00246   <span class="keywordtype">int</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#7496fe09ce10bd84eac5ea6e44c8bc31">Send</a>(<span class="keywordtype">int</span> len, <span class="keyword">const</span> <span class="keywordtype">char</span>* buf);
<a name="l00247"></a>00247 
<a name="l00260"></a>00260   <span class="keywordtype">int</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#b80c9ed1145f7d4e42240f6b8de09c0f">SendPreparedBuffer</a>(<span class="keywordtype">int</span> len, <span class="keywordtype">char</span>* buf);
<a name="l00261"></a>00261 
<a name="l00262"></a>00262   <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#fe2be9fbe6bf41d5cfd01842cd244bec">PrepareBufferForBip</a>(<span class="keywordtype">char</span> * buf, <span class="keyword">const</span> <span class="keywordtype">char</span> * data, <span class="keywordtype">int</span> datalen);
<a name="l00263"></a>00263   <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#4cf50d6658d62b2d4302c81fa634a89e">WriteHeaderForBip</a>(<span class="keywordtype">char</span> * buf, <span class="keywordtype">int</span> service_id, <span class="keywordtype">int</span> message_id );
<a name="l00264"></a>00264 
<a name="l00265"></a>00265   <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#0e59a668c2605cd4fae73fdb679dd615">PrepareBufferForBipFromCuttedMsg</a>(<span class="keywordtype">char</span> * buf, <span class="keywordtype">int</span>* tab_length, <span class="keyword">const</span> <span class="keywordtype">char</span>** tab_buf, <span class="keywordtype">int</span> nb_buf);
<a name="l00266"></a>00266 
<a name="l00276"></a>00276   <span class="keywordtype">int</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#4a2314b70a47858c24edbaa8636bcbe6">SendCuttedMsg</a>(<span class="keywordtype">int</span>* tab_len, <span class="keyword">const</span> <span class="keywordtype">char</span>** tab_buf, <span class="keywordtype">int</span> nb_buf);
<a name="l00277"></a>00277 
<a name="l00284"></a>00284   <span class="keywordtype">int</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#5c449b68e25f5cf173d0a69a699a975b">SendTo</a>(<span class="keywordtype">int</span> len, <span class="keyword">const</span> <span class="keywordtype">char</span>* buf, <a class="code" href="class_omiscid_1_1_udp_connection.html">UdpConnection</a>* udp_dest);
<a name="l00285"></a>00285   
<a name="l00288"></a>00288   <a class="code" href="class_omiscid_1_1_socket.html">Socket</a>* <a class="code" href="class_omiscid_1_1_msg_socket.html#66d6616574ad4f410e424a1e12fe1106">GetSocket</a>() <span class="keyword">const</span>;
<a name="l00289"></a>00289 
<a name="l00292"></a>00292   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#abc7fca62eb753cff2f578a4fbbdfa79">GetPortNb</a>() <span class="keyword">const</span>;
<a name="l00293"></a>00293 
<a name="l00296"></a>00296   <span class="keywordtype">bool</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#643130a0e78dc5780e41571149ffb31c">IsConnected</a>() <span class="keyword">const</span>;
<a name="l00297"></a>00297   
<a name="l00302"></a>00302   <span class="keywordtype">void</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#36d29279121e5b48c35df617c095734b">Stop</a>();
<a name="l00303"></a>00303 
<a name="l00308"></a>00308   <span class="keywordtype">void</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#7567f7b5736b8363e464cec76a978276">SetServiceId</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pid);
<a name="l00309"></a>00309 
<a name="l00312"></a>00312   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#c462f84f6ce4bf81a07af2a07513a3c1">GetServiceId</a>() <span class="keyword">const</span>;
<a name="l00313"></a>00313   
<a name="l00315"></a>00315   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#11758f2a2dd4bb671849cb1856ee9a91">GetPeerPid</a>() <span class="keyword">const</span>;
<a name="l00316"></a>00316 
<a name="l00323"></a>00323   <span class="keywordtype">bool</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#ed776388f004399875e8629248d4f655">ReceivedSyncLinkMsg</a>();
<a name="l00324"></a>00324 
<a name="l00330"></a>00330   <span class="keywordtype">bool</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#7d87ebb3ed18bb10f3074e2730feb9e6">WaitSyncLinkMsg</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> TimeToWait = 250);
<a name="l00331"></a>00331 
<a name="l00338"></a>00338   <span class="keywordtype">bool</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#3ea7ed453da5945b9268aaf374059388">SyncLinkMsgSent</a>() <span class="keyword">const</span>;
<a name="l00339"></a>00339 
<a name="l00340"></a>00340   <span class="comment">// TO COMMENT</span>
<a name="l00341"></a>00341         <span class="keywordtype">bool</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#e77ffd60b132475148b513da8191757f">SendSyncLinkMsg</a>();
<a name="l00342"></a>00342 
<a name="l00345"></a>00345   <span class="keywordtype">int</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#30b58f15022ccc68fc521c4c34429892">GetMaxMessageSizeForTCP</a>() <span class="keyword">const</span>;
<a name="l00346"></a>00346 
<a name="l00349"></a>00349   <span class="keywordtype">void</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#88ed9e61763cf158e962a9f5cd342f5f">SetMaxMessageSizeForTCP</a>(<span class="keywordtype">int</span> max);
<a name="l00350"></a>00350 
<a name="l00354"></a>00354   <span class="keywordtype">bool</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#8763f358c828376a54834a2a7520a603">operator==</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> peer_id) <span class="keyword">const</span>;
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 
<a name="l00360"></a>00360   <span class="keywordtype">bool</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#853ad7a7a3b7ea7afa9dff79a74ddc1a">SetTcpNoDelay</a>(<span class="keywordtype">bool</span> Set = <span class="keyword">true</span>);
<a name="l00361"></a>00361 
<a name="l00362"></a>00362     <span class="comment">// REVIEW </span>
<a name="l00363"></a>00363   <span class="keywordtype">bool</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#82d7f03e8a3acbfdd82bc35d3c1589f3">SetSyncLinkData</a>( <a class="code" href="class_omiscid_1_1_simple_string.html">SimpleString</a> DataForSL );
<a name="l00364"></a>00364   <a class="code" href="class_omiscid_1_1_simple_string.html">SimpleString</a> <a class="code" href="class_omiscid_1_1_msg_socket.html#506ead22a9cd791637fdf9b72c936fae">GetSyncLinkData</a>();
<a name="l00365"></a>00365   <a class="code" href="class_omiscid_1_1_simple_string.html">SimpleString</a> <a class="code" href="class_omiscid_1_1_msg_socket.html#00e2aba97c10608f208f69f58c953735">GetPeerSyncLinkData</a>();
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 <span class="keyword">protected</span>:
<a name="l00368"></a>00368 
<a name="l00377"></a>00377   <span class="keyword">virtual</span> <span class="keywordtype">bool</span> AcceptConnection(<a class="code" href="class_omiscid_1_1_msg_socket.html">MsgSocket</a>* s);
<a name="l00378"></a>00378 
<a name="l00392"></a>00392  <span class="keyword">virtual</span> <a class="code" href="class_omiscid_1_1_udp_connection.html">UdpConnection</a>* AcceptConnection(<span class="keyword">const</span> <a class="code" href="class_omiscid_1_1_udp_connection.html">UdpConnection</a>&amp; udp_connect, <span class="keywordtype">bool</span> msg_empty);
<a name="l00393"></a>00393  
<a name="l00394"></a>00394 
<a name="l00395"></a><a class="code" href="class_omiscid_1_1_msg_socket.html#0d5c96d03589cdf47a3803ac3365249d">00395</a>   <a class="code" href="class_omiscid_1_1_mutexed_simple_list.html">MutexedSimpleList&lt;MsgSocketCallbackObject*&gt;</a>   <a class="code" href="class_omiscid_1_1_msg_socket.html#0d5c96d03589cdf47a3803ac3365249d">CallbackObjects</a>;        
<a name="l00396"></a><a class="code" href="class_omiscid_1_1_msg_socket.html#deba601f8dc26650cf4168a4bcc2c03a">00396</a>   <a class="code" href="class_omiscid_1_1_msg_socket_call_back_data.html">MsgSocketCallBackData</a>                         <a class="code" href="class_omiscid_1_1_msg_socket.html#deba601f8dc26650cf4168a4bcc2c03a">callbackData</a>;           
<a name="l00398"></a><a class="code" href="class_omiscid_1_1_msg_socket.html#f8de8404f66db44e0a1beed0d48abb7f">00398</a>   <a class="code" href="class_omiscid_1_1_mutex.html">Mutex</a> <a class="code" href="class_omiscid_1_1_msg_socket.html#f8de8404f66db44e0a1beed0d48abb7f">mutex</a>;                                                          
<a name="l00399"></a><a class="code" href="class_omiscid_1_1_msg_socket.html#eafc599eec5aca8cfeea9727bf984f46">00399</a>   <a class="code" href="class_omiscid_1_1_msg_socket.html#755a9ab6299c74f203aec3ae5a4a4c47">Callback_SyncLink</a> <a class="code" href="class_omiscid_1_1_msg_socket.html#eafc599eec5aca8cfeea9727bf984f46">callbackSyncLinkFct</a>;                                
<a name="l00400"></a><a class="code" href="class_omiscid_1_1_msg_socket.html#bb8e5097944097a27947a933ca86b2af">00400</a>   <a class="code" href="class_omiscid_1_1_msg_socket_call_back_data.html">MsgSocketCallBackData</a> <a class="code" href="class_omiscid_1_1_msg_socket.html#bb8e5097944097a27947a933ca86b2af">callbackSyncLinkData</a>;
<a name="l00401"></a><a class="code" href="class_omiscid_1_1_msg_socket.html#dc2366e1f8bd98228d4b21d9b752610a">00401</a>   <a class="code" href="class_omiscid_1_1_simple_string.html">SimpleString</a> <a class="code" href="class_omiscid_1_1_msg_socket.html#dc2366e1f8bd98228d4b21d9b752610a">SyncLinkData</a>;
<a name="l00402"></a><a class="code" href="class_omiscid_1_1_msg_socket.html#51c73d04bd18488cd80d5d792114b6cf">00402</a>   <a class="code" href="class_omiscid_1_1_simple_string.html">SimpleString</a> <a class="code" href="class_omiscid_1_1_msg_socket.html#51c73d04bd18488cd80d5d792114b6cf">PeerSyncLinkData</a>;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 <span class="keyword">private</span>:
<a name="l00410"></a>00410   <span class="keywordtype">void</span> <a class="code" href="class_omiscid_1_1_msg_socket.html#626bf84517ed66dd14358ba09da0dac4">AcceptConnection</a>();
<a name="l00411"></a>00411 
<a name="l00419"></a>00419   <span class="keywordtype">void</span> Receive();
<a name="l00420"></a>00420 
<a name="l00426"></a>00426   <span class="keywordtype">void</span> ReceiveUdpExchange();
<a name="l00427"></a>00427 
<a name="l00437"></a>00437   <span class="keywordtype">bool</span> MoveToMessage(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* buf, <span class="keywordtype">int</span> len, <span class="keywordtype">int</span>&amp; decal);
<a name="l00438"></a>00438 
<a name="l00451"></a>00451   <span class="keywordtype">int</span> GoodBeginning(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* buf, <span class="keywordtype">int</span> len, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; lengthmsg, 
<a name="l00452"></a>00452                     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; pid, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; mid);
<a name="l00454"></a>00454 
<a name="l00455"></a>00455 <span class="keyword">private</span>:
<a name="l00456"></a>00456 
<a name="l00457"></a>00457         <span class="comment">// REVIEW : can only be done internaly</span>
<a name="l00458"></a>00458   <span class="keywordtype">bool</span> SetPeerSyncLinkData( <span class="keywordtype">char</span>* DataForSL, <span class="keywordtype">int</span> DataLength );
<a name="l00459"></a>00459 
<a name="l00460"></a>00460         <span class="comment">// let say that TcpServer Need to now these constant values</span>
<a name="l00461"></a><a class="code" href="class_omiscid_1_1_msg_socket.html#3ecf3132e8c4bf890c07853cfab7619c">00461</a>         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="class_omiscid_1_1_tcp_server.html">TcpServer</a>;
<a name="l00462"></a>00462 
<a name="l00463"></a>00463   <a class="code" href="class_omiscid_1_1_socket.html">Socket</a>* socket; 
<a name="l00465"></a>00465   <span class="keywordtype">int</span> bufferSize; 
<a name="l00466"></a>00466   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * buffer; 
<a name="l00467"></a>00467   <span class="keywordtype">int</span> occupiedSize; 
<a name="l00469"></a>00469   <span class="keywordtype">bool</span> connected; 
<a name="l00471"></a>00471   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* tag_start1; 
<a name="l00472"></a>00472   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* tag_start2; 
<a name="l00473"></a>00473   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* tag_end; 
<a name="l00474"></a>00474   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* tag_str; 
<a name="l00475"></a>00475   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* tag_prepared_hdr; 
<a name="l00476"></a>00476   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* tag_prepared_serv; 
<a name="l00478"></a>00478   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> tag_end_size; 
<a name="l00479"></a>00479   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> tag_size; 
<a name="l00480"></a>00480   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> pid_size; 
<a name="l00481"></a>00481   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> mid_size; 
<a name="l00482"></a>00482   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> len_size; 
<a name="l00484"></a>00484   <span class="keywordtype">char</span>* start_tag;
<a name="l00485"></a>00485   <span class="keywordtype">char</span>* buffer_udp_send;
<a name="l00486"></a>00486 
<a name="l00487"></a>00487   <a class="code" href="class_omiscid_1_1_msg_socket.html#4d9ba56644652acfe0e4f6ade0e9659b">MsgSocketKind</a> kind;
<a name="l00488"></a>00488 
<a name="l00489"></a>00489   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * SendBuffer;
<a name="l00490"></a>00490   <a class="code" href="class_omiscid_1_1_reentrant_mutex.html">ReentrantMutex</a> protectSend; 
<a name="l00492"></a>00492   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> service_id; 
<a name="l00493"></a>00493   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> message_id; 
<a name="l00495"></a>00495   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> peer_pid; 
<a name="l00497"></a>00497   <span class="keywordtype">bool</span> receivedSyncLinkMsg;
<a name="l00498"></a>00498   <span class="keywordtype">bool</span> sendSyncLinkMsg;
<a name="l00499"></a>00499 
<a name="l00500"></a>00500   <span class="keywordtype">int</span> maxMessageSizeForTCP;
<a name="l00501"></a>00501   <span class="keywordtype">int</span> maxBIPMessageSize;
<a name="l00502"></a>00502 
<a name="l00505"></a>00505   <a class="code" href="class_omiscid_1_1_simple_string.html">SimpleString</a> Name;                                            
<a name="l00506"></a>00506   <span class="keyword">const</span> <a class="code" href="class_omiscid_1_1_simple_string.html">SimpleString</a> DefaultMsgSocketName;  
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 <span class="keyword">protected</span>:
<a name="l00510"></a><a class="code" href="class_omiscid_1_1_msg_socket.html#8ef83dfae782b01709b496d2e6901ff2">00510</a>   <a class="code" href="class_omiscid_1_1_udp_connection.html">UdpConnection</a> <a class="code" href="class_omiscid_1_1_msg_socket.html#8ef83dfae782b01709b496d2e6901ff2">udpConnection</a>;
<a name="l00511"></a>00511 };
<a name="l00512"></a>00512 
<a name="l00513"></a>00513 } <span class="comment">// namespace Omiscid</span>
<a name="l00514"></a>00514 
<a name="l00515"></a>00515 <span class="preprocessor">#endif // __MSG_SOCKET_H__</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri Sep 22 11:48:30 2006 for OMiSCID(aka O3MiSCID) by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.6 </small></address>
</body>
</html>
